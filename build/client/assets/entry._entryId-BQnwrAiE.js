import{w as b,p as e,v as j,a as u,t as l}from"./chunk-PVWAREVJ-BCzKU303.js";import{u as f}from"./supabaseClient-BnqcRS6D.js";import{u as N,Q as v,a as k}from"./QueryClientProvider-C6_AEzee.js";import{u as E,a as w}from"./journal-CityovO2.js";import{u as T,Q as c,T as _}from"./TaskForm-BEfxIYoC.js";function S(){const o=N();return T({mutationFn:async n=>{console.log("ðŸš€ EDIT JOURNAL MUTATION: Starting",n);const s=await E(n.id,n);return console.log("âœ… EDIT JOURNAL MUTATION: Server returned",s),s},onMutate:async n=>{await o.cancelQueries({queryKey:c.journalEntry(String(n.id))});const s=o.getQueryData(c.journalEntry(String(n.id)));if(console.log("ðŸ”„ EDIT JOURNAL ONMUTATE: Previous entry:",s),s){const a={...s,...n,updated_at:new Date().toISOString()};o.setQueryData(c.journalEntry(String(n.id)),a),console.log("ðŸ”„ EDIT JOURNAL ONMUTATE: Optimistically updated cache",a)}return{previousEntry:s}},onError:(n,s,a)=>{console.error("âŒ EDIT JOURNAL ONERROR:",n),a?.previousEntry&&o.setQueryData(c.journalEntry(String(s.id)),a.previousEntry)},onSettled:(n,s,a)=>{console.log("ðŸ”„ EDIT JOURNAL ONSETTLED: Refetching entry",a?.id),o.invalidateQueries({queryKey:c.journalEntry(String(a?.id))})}})}const J=new v,A=b(function(){return e.jsx(k,{client:J,children:e.jsx(I,{})})});function I(){const{entryId:o}=j(),{data:r,isLoading:n,error:s}=f({queryKey:["journalEntry",o],queryFn:()=>w(Number(o)),enabled:!!o&&!isNaN(Number(o))}),[a,x]=u.useState(""),[y,g]=u.useState(null),p=S();u.useEffect(()=>{r&&x(r.editorial_text??"")},[r]),u.useEffect(()=>{if(!r)return;const t=setTimeout(()=>{a!==(r.editorial_text??"")&&p.mutate({id:r.id,editorial_text:a})},1e4);return()=>clearTimeout(t)},[a,r,p]);const h=t=>new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=t=>new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"});return!o||isNaN(Number(o))?e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Invalid Entry ID"}),e.jsx(l,{to:"/journal",className:"text-blue-600 hover:underline",children:"â† Back to Journal"})]})}):e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900",children:[e.jsxs("nav",{className:"bg-gray-900 dark:bg-gray-800 px-4 py-3 space-x-4",children:[e.jsx(l,{to:"/",className:"text-gray-300 hover:text-white transition-colors",children:"Home"}),e.jsx(l,{to:"/journal",className:"text-gray-300 hover:text-white transition-colors",children:"Journal"})]}),e.jsxs("main",{className:"p-8 max-w-4xl mx-auto",children:[n&&e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Loading entry..."})}),s&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"text-red-600 dark:text-red-400 mb-4",children:["Error loading journal entry: ",s.message]}),e.jsx(l,{to:"/journal",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"â† Back to Journal"})]}),r===null&&!n&&!s&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Journal entry not found"}),e.jsx(l,{to:"/journal",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"â† Back to Journal"})]}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:h(r.entry_date)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:[e.jsxs("div",{children:["Entry #",r.id]}),e.jsxs("div",{children:["Created: ",m(r.created_at)]}),r.updated_at!==r.created_at&&e.jsxs("div",{children:["Updated: ",m(r.updated_at)]})]})]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Journal Entry"}),e.jsx("label",{className:"block mb-2 font-semibold text-gray-700 dark:text-gray-300",children:"Details:"}),e.jsx("textarea",{className:"w-full p-2 border rounded mb-4 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600",rows:4,value:a,onChange:t=>x(t.target.value)})]}),r.tasks&&r.tasks.length>0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Task Activity"}),e.jsx("div",{className:"space-y-3",children:r.tasks.map(t=>e.jsxs("div",{onClick:()=>t.org_node&&g(t.org_node),className:"flex items-center justify-between bg-white dark:bg-gray-700 rounded p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.action==="completed"?"bg-green-500":t.action==="created"?"bg-blue-500":"bg-yellow-500"}`}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 capitalize",children:t.action}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["task #",t.org_node_id,t.org_node&&`: ${t.org_node.name}`]})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:m(t.created_at)})]},t.id))})]}),r.tasks&&r.tasks.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg p-6 border-2 border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"AI Journal Prompt"}),e.jsx("button",{onClick:()=>{const t=document.getElementById("ai-prompt")?.innerText;t&&(navigator.clipboard.writeText(t),alert("Prompt copied to clipboard!"))},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm",children:"Copy Prompt"})]}),e.jsx("div",{id:"ai-prompt",className:"bg-white dark:bg-gray-800 rounded p-4 font-mono text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:`I'm creating a journal entry for ${h(r.entry_date)}. Please help me write a meaningful reflection based on my task activity for the day.

Task Activity Summary:
${r.tasks.map(t=>{const i=t.org_node;if(!i)return`- ${t.action.toUpperCase()}: task #${t.org_node_id} (details unavailable)`;const d=[`- ${t.action.toUpperCase()}: ${i.name}`];return i.details&&d.push(`  Description: ${i.details}`),i.importance&&d.push(`  Importance: ${i.importance}/10`),i.deadline&&d.push(`  Deadline: ${new Date(i.deadline).toLocaleDateString()}`),i.completion_time&&d.push(`  Estimated time: ${i.completion_time} hours`),t.action==="completed"&&i.completion_comment&&d.push(`  Completion note: ${i.completion_comment}`),d.join(`
`)}).join(`

`)}

${a?`
My initial thoughts:
${a}
`:""}
Please help me create a journal entry that:
1. Reflects on the significance of these task activities
2. Identifies any patterns or themes in my work
3. Acknowledges progress and accomplishments
4. Notes any challenges or concerns
5. Provides thoughtful perspective on my productivity and priorities

Write in a personal, reflective tone suitable for a private journal entry.`})]}),e.jsxs("div",{className:"flex space-x-4 pt-6",children:[e.jsx(l,{to:"/journal",className:"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"â† Back to Journal"}),e.jsx(l,{to:`/journal/edit/${r.id}`,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Edit Entry"})]})]}),y&&e.jsx(_,{task:y,onCancel:()=>g(null)})]})]})}export{A as default};
