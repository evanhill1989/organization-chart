import{a as l,p as n}from"./chunk-PVWAREVJ-BCzKU303.js";import{S as ne,s as se,h as H,g as ae,n as z,u as E,b as ie,c as oe}from"./QueryClientProvider-C6_AEzee.js";import{s as N}from"./supabaseClient-BnqcRS6D.js";var ce=class extends ne{#t;#n=void 0;#e;#r;constructor(e,r){super(),this.#t=e,this.setOptions(r),this.bindMethods(),this.#s()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const r=this.options;this.options=this.#t.defaultMutationOptions(e),se(this.options,r)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),r?.mutationKey&&this.options.mutationKey&&H(r.mutationKey)!==H(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#s(),this.#a(e)}getCurrentResult(){return this.#n}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#s(),this.#a()}mutate(e,r){return this.#r=r,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(e)}#s(){const e=this.#e?.state??ae();this.#n={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){z.batch(()=>{if(this.#r&&this.hasListeners()){const r=this.#n.variables,s=this.#n.context;e?.type==="success"?(this.#r.onSuccess?.(e.data,r,s),this.#r.onSettled?.(e.data,null,r,s)):e?.type==="error"&&(this.#r.onError?.(e.error,r,s),this.#r.onSettled?.(void 0,e.error,r,s))}this.listeners.forEach(r=>{r(this.#n)})})}};function T(e,r){const s=E(),[t]=l.useState(()=>new ce(s,e));l.useEffect(()=>{t.setOptions(e)},[t,e]);const a=l.useSyncExternalStore(l.useCallback(c=>t.subscribe(z.batchCalls(c)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),o=l.useCallback((c,y)=>{t.mutate(c,y).catch(ie)},[t]);if(a.error&&oe(t.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}const g={orgTree:e=>["orgTree",e],allOrgTrees:()=>["orgTree"],task:e=>["task",e],allTasks:()=>["allTasks"],recentTasks:()=>["recentTasks"],urgentTaskCount:e=>e?["urgentTaskCount",e]:["urgentTaskCount"],criticalTaskCount:e=>["criticalTaskCount",e],category:e=>["category",e],allCategories:()=>["categories"],journalEntry:e=>["journalEntry",e]},le=()=>{const e=E();return T({mutationFn:async r=>{if(r.id){const{data:s,error:t}=await N.from("org_nodes").update(r).eq("id",r.id).select().single();if(t)throw t;return s}else{const{data:s,error:t}=await N.from("org_nodes").insert({...r,type:"task"}).select().single();if(t)throw t;return s}},onSuccess:r=>{e.setQueryData(g.task(r.id),r),e.invalidateQueries({queryKey:g.allOrgTrees()}),e.invalidateQueries({queryKey:g.allTasks()}),e.invalidateQueries({queryKey:g.urgentTaskCount()})},onError:r=>{console.error("‚ùå Save task error:",r)}})},ue=()=>{const e=E();return T({mutationFn:async r=>{const{error:s}=await N.from("org_nodes").delete().eq("id",r);if(s)throw s;return r},onSuccess:r=>{e.removeQueries({queryKey:g.task(r)}),e.invalidateQueries({queryKey:g.allOrgTrees()}),e.invalidateQueries({queryKey:g.allTasks()}),e.invalidateQueries({queryKey:g.urgentTaskCount()})},onError:r=>{console.error("‚ùå Delete task error:",r)}})};function de(e,r){const s=new Date(e),t=new Date(s);switch(r.type){case"minutely":return t.setMinutes(t.getMinutes()+r.interval),t.toISOString();case"daily":t.setDate(t.getDate()+r.interval);break;case"weekly":if(r.dayOfWeek!==void 0){const a=(r.dayOfWeek-t.getDay()+7)%7;t.setDate(t.getDate()+a+(r.interval-1)*7)}else t.setDate(t.getDate()+r.interval*7);break;case"monthly":if(r.dayOfMonth!==void 0)t.setMonth(t.getMonth()+r.interval),t.setDate(Math.min(r.dayOfMonth,V(t)));else{const a=s.getDate();t.setMonth(t.getMonth()+r.interval),t.setDate(Math.min(a,V(t)))}break;case"yearly":t.setFullYear(t.getFullYear()+r.interval);break;default:throw new Error(`Unsupported recurrence type: ${r.type}`)}return r.type==="minutely"?t.toISOString():t.toISOString().split("T")[0]}function me(e,r){if(!r)return!0;const s=new Date(e),t=new Date(r);return s<=t}function V(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}function he(e){const{type:r,interval:s,dayOfWeek:t,dayOfMonth:a}=e,o=s===1?"Weekly":`Every ${s} weeks`,c=s===1?"Monthly":`Every ${s} months`,y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];switch(r){case"minutely":return s===1?"Every minute":`Every ${s} minutes`;case"daily":return s===1?"Daily":`Every ${s} days`;case"weekly":return t!==void 0?`${o} on ${y[t]}`:o;case"monthly":if(a!==void 0){const h=ge(a);return`${c} on the ${a}${h}`}return c;case"yearly":return s===1?"Yearly":`Every ${s} years`;default:return"No recurrence"}}function ge(e){if(e>=11&&e<=13)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function ye({initialConfig:e,onChange:r,disabled:s=!1,className:t=""}){const[a,o]=l.useState(e?.type||"none"),[c,y]=l.useState(e?.interval||1),[h,x]=l.useState(e?.dayOfWeek??""),[d,v]=l.useState(e?.dayOfMonth??""),[p,C]=l.useState(e?.endDate||""),D=l.useRef("");return l.useEffect(()=>{if(e){const u=JSON.stringify(e);u!==D.current&&(console.log("üîÑ RecurrenceConfig: Updating from initialConfig:",e),o(e.type||"none"),y(e.interval||1),x(e.dayOfWeek??""),v(e.dayOfMonth??""),C(e.endDate||""),D.current=u)}},[e]),l.useEffect(()=>{const u={recurrence_type:a,recurrence_interval:a!=="none"?c:void 0,recurrence_day_of_week:a==="weekly"&&h!==""?Number(h):void 0,recurrence_day_of_month:a==="monthly"&&d!==""?Number(d):void 0,recurrence_end_date:a!=="none"&&p?p:void 0,is_recurring_template:a!=="none"};console.log("üîÑ RecurrenceConfig: Emitting config change:",u),r(u)},[a,c,h,d,p]),n.jsxs("div",{className:`rounded border bg-gray-50 p-4 dark:bg-gray-800 ${t}`,children:[n.jsxs("h4",{className:"mb-3 flex items-center font-medium text-gray-700 dark:text-gray-300",children:[n.jsx("svg",{className:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Repeat Task"]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Repeat:"}),n.jsxs("select",{className:"w-full rounded border border-gray-300 px-3 py-2 text-black focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:a,onChange:u=>{console.log("üîÑ RecurrenceConfig: Type changed to:",u.target.value),o(u.target.value)},disabled:s,children:[n.jsx("option",{value:"none",children:"No repeat"}),n.jsx("option",{value:"minutely",children:"Every minute (testing)"}),n.jsx("option",{value:"daily",children:"Daily"}),n.jsx("option",{value:"weekly",children:"Weekly"}),n.jsx("option",{value:"monthly",children:"Monthly"}),n.jsx("option",{value:"yearly",children:"Yearly"})]})]}),a!=="none"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Every:"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"number",min:"1",max:"365",className:"w-20 rounded border border-gray-300 px-3 py-2 text-black focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c,onChange:u=>y(Number(u.target.value)),disabled:s}),n.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a==="minutely"&&(c===1?"minute":"minutes"),a==="daily"&&(c===1?"day":"days"),a==="weekly"&&(c===1?"week":"weeks"),a==="monthly"&&(c===1?"month":"months"),a==="yearly"&&(c===1?"year":"years")]})]})]}),a==="weekly"&&n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"On day:"}),n.jsxs("select",{className:"w-full rounded border border-gray-300 px-3 py-2 text-black focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:h,onChange:u=>x(u.target.value?Number(u.target.value):""),disabled:s,children:[n.jsx("option",{value:"",children:"Same day as deadline"}),n.jsx("option",{value:"0",children:"Sunday"}),n.jsx("option",{value:"1",children:"Monday"}),n.jsx("option",{value:"2",children:"Tuesday"}),n.jsx("option",{value:"3",children:"Wednesday"}),n.jsx("option",{value:"4",children:"Thursday"}),n.jsx("option",{value:"5",children:"Friday"}),n.jsx("option",{value:"6",children:"Saturday"})]})]}),a==="monthly"&&n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"On day of month:"}),n.jsxs("select",{className:"w-full rounded border border-gray-300 px-3 py-2 text-black focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:d,onChange:u=>v(u.target.value?Number(u.target.value):""),disabled:s,children:[n.jsx("option",{value:"",children:"Same day as deadline"}),Array.from({length:31},(u,O)=>O+1).map(u=>n.jsx("option",{value:u,children:u},u))]})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"End repeat (optional):"}),n.jsx("input",{type:"date",className:"w-full rounded border border-gray-300 px-3 py-2 text-black focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:p,onChange:u=>C(u.target.value),min:new Date().toISOString().split("T")[0],disabled:s})]}),n.jsxs("div",{className:"mt-3 rounded border-l-4 border-blue-400 bg-blue-50 p-2 dark:bg-blue-900/20",children:[n.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[n.jsx("strong",{children:"Pattern:"})," ",he({type:a,interval:c,dayOfWeek:h!==""?Number(h):void 0,dayOfMonth:d!==""?Number(d):void 0})]}),p&&n.jsxs("p",{className:"mt-1 text-sm text-blue-700 dark:text-blue-300",children:[n.jsx("strong",{children:"Ends:"})," ",new Date(p).toLocaleDateString()]})]})]})]})}async function fe(e){if(console.log("üîç DEBUG - createRecurringInstance called with task:",{name:e.name,id:e.id,is_completed:e.is_completed,is_recurring_template:e.is_recurring_template,recurring_template_id:e.recurring_template_id,recurrence_type:e.recurrence_type,deadline:e.deadline,parent_id:e.parent_id}),console.log("üîÑ createRecurringInstance called for task:",e.name),!e.is_recurring_template&&!e.recurring_template_id)return console.log("‚ùå Check 1 FAILED: Task is not recurring",{is_recurring_template:e.is_recurring_template,recurring_template_id:e.recurring_template_id}),null;if(console.log("‚úÖ Check 1 PASSED: Task is recurring"),e.recurrence_type==="none"||!e.recurrence_type)return console.log("‚ùå Check 2 FAILED: No recurrence type set",{recurrence_type:e.recurrence_type}),null;if(console.log("‚úÖ Check 2 PASSED: Recurrence type is set:",e.recurrence_type),!e.is_completed)return console.log("‚ùå Check 3 FAILED: Task is not marked as completed",{is_completed:e.is_completed}),null;console.log("‚úÖ Check 3 PASSED: Task is completed"),console.log("üîç Check 4: Checking for recent instances...");const r=new Date(Date.now()-6e4).toISOString();let s=N.from("org_nodes").select("id, name, created_at").eq("name",e.name).eq("recurring_template_id",e.is_recurring_template?e.id:e.recurring_template_id).gte("created_at",r);e.parent_id!=null?s=s.eq("parent_id",e.parent_id):s=s.is("parent_id",null);const{data:t,error:a}=await s;if(a)throw console.error("‚ùå Check 4 ERROR: Error checking for recent instances:",a),a;if(console.log("üîç Check 4 RESULT: Recent instances found:",t),t&&t.length>0)return console.log("‚ùå Check 4 FAILED: Recent instance already exists, skipping creation"),null;console.log("‚úÖ Check 4 PASSED: No recent instances found"),console.log("üîç Check 5: Calculating next deadline...");try{const o=de(e.deadline||new Date().toISOString().split("T")[0],{type:e.recurrence_type,interval:e.recurrence_interval||1,dayOfWeek:e.recurrence_day_of_week,dayOfMonth:e.recurrence_day_of_month,endDate:e.recurrence_end_date});if(console.log("‚úÖ Check 5 PASSED: Next deadline calculated:",o),!me(o,e.recurrence_end_date))return console.log("‚ùå Check 6 FAILED: Recurrence end date reached",{nextDeadline:o,endDate:e.recurrence_end_date}),null;console.log("‚úÖ Check 6 PASSED: Should create next instance"),console.log(e,"THE FUCKING COMPLETED TASK!!!"),console.log(e.parent_id,"THE FUCKING COMPLETED TASK PARENT_ID!!!!!!!!");const c={name:e.name,type:"task",details:e.details,importance:e.importance,deadline:o,completion_time:e.completion_time,unique_days_required:e.unique_days_required,parent_id:e.parent_id||null,tab_name:e.tab_name,root_category:e.root_category,recurrence_type:e.recurrence_type,recurrence_interval:e.recurrence_interval,recurrence_day_of_week:e.recurrence_day_of_week,recurrence_day_of_month:e.recurrence_day_of_month,recurrence_end_date:e.recurrence_end_date,is_recurring_template:!1,recurring_template_id:e.is_recurring_template?e.id:e.recurring_template_id};console.log("üîç DEBUG - newTaskData before insertion:",c),console.log("üîÑ Creating next recurring instance:",{originalTask:e.name,newDeadline:o,recurrenceType:e.recurrence_type,newTaskData:c});const{data:y,error:h}=await N.from("org_nodes").insert([c]).select().single();if(h)throw console.error("‚ùå Database error creating recurring instance:",h),h;return console.log("‚úÖ Successfully created recurring instance:",y),y}catch(o){throw console.error("‚ùå Failed to create recurring instance:",o),o}}function pe(){const e=E();return T({mutationFn:async r=>{const{error:s}=await N.from("org_nodes").update({last_touched_at:new Date().toISOString()}).eq("id",r);if(s)throw s},onSuccess:()=>{e.invalidateQueries({queryKey:g.recentTasks()})}})}async function _e({id:e,name:r,details:s,importance:t,deadline:a,completion_time:o,unique_days_required:c,is_completed:y,completed_at:h,completion_comment:x}){const d={};r!==void 0&&(d.name=r),s!==void 0&&(d.details=s),t!==void 0&&(d.importance=t),a!==void 0&&(d.deadline=a),o!==void 0&&(d.completion_time=o),c!==void 0&&(d.unique_days_required=c),y!==void 0&&(d.is_completed=y),h!==void 0&&(d.completed_at=h??void 0),x!==void 0&&(d.completion_comment=x),d.last_touched_at=new Date().toISOString();const{data:v,error:p}=await N.from("org_nodes").update(d).eq("id",e).select().single();if(p)throw p;return v}const be={traverse(e,r){r(e),e.children&&e.children.length>0&&e.children.forEach(s=>this.traverse(s,r))},findById(e,r){if(e.id===r)return e;if(e.children&&e.children.length>0)for(const s of e.children){const t=this.findById(s,r);if(t)return t}return null},updateNode(e,r,s){if(e.id===r)return{...e,...s};if(e.children&&e.children.length>0){const t=e.children.map(a=>this.updateNode(a,r,s));return{...e,children:t}}return e},addChild(e,r,s){return r?e.id===r?{...e,children:[...e.children??[],s]}:e.children&&e.children.length>0?{...e,children:e.children.map(t=>this.addChild(t,r,s))}:e:{...e,children:[...e.children??[],s]}},removeNode(e,r){if(e.id===r)return null;if(e.children&&e.children.length>0){const s=e.children.map(t=>this.removeNode(t,r)).filter(t=>t!==null);return{...e,children:s}}return e},getDescendants(e){const r=[e];return e.children&&e.children.length>0&&e.children.forEach(s=>{r.push(...this.getDescendants(s))}),r},getNodePath(e,r){if(e.id===r)return[e];if(e.children&&e.children.length>0)for(const s of e.children){const t=this.getNodePath(s,r);if(t.length>0)return[e,...t]}return[]},countNodes(e){let r=1;return e.children&&e.children.length>0&&(r+=e.children.reduce((s,t)=>s+this.countNodes(t),0)),r},getMaxDepth(e){return!e.children||e.children.length===0?1:1+Math.max(...e.children.map(r=>this.getMaxDepth(r)))},filter(e,r){const s=[];return this.traverse(e,t=>{r(t)&&s.push(t)}),s},map(e,r){const s=r(e);return s.children&&s.children.length>0?{...s,children:s.children.map(t=>this.map(t,r))}:s}};function xe(e){const r=E();return T({mutationFn:async t=>await _e(t),onMutate:async t=>{await r.cancelQueries({queryKey:g.orgTree(e)});const a=r.getQueryData(g.orgTree(e));if(!a||!t.id)return{previousTree:null};const o={};t.name!==void 0&&(o.name=t.name),t.details!==void 0&&(o.details=t.details),t.importance!==void 0&&(o.importance=t.importance),t.deadline!==void 0&&(o.deadline=t.deadline),t.completion_time!==void 0&&(o.completion_time=t.completion_time),t.unique_days_required!==void 0&&(o.unique_days_required=t.unique_days_required),t.is_completed!==void 0&&(o.is_completed=t.is_completed),t.completed_at!==void 0&&(o.completed_at=t.completed_at===null?void 0:t.completed_at),t.completion_comment!==void 0&&(o.completion_comment=t.completion_comment);const c=be.updateNode(a,t.id,o);return r.setQueryData(g.orgTree(e),c),{previousTree:a}},onError:(t,a,o)=>{console.log("‚ùå EDIT ONERROR: Edit failed for node:",a.id,"Error:",t),o?.previousTree&&r.setQueryData(g.orgTree(e),o.previousTree)},onSettled:()=>{r.invalidateQueries({queryKey:g.orgTree(e)}),r.invalidateQueries({queryKey:g.urgentTaskCount()}),r.invalidateQueries({queryKey:g.recentTasks()})}})}function je({task:e,onCancel:r,parentId:s,parentName:t,rootCategory:a,tabName:o}){const[c,y]=l.useState(e?.name??""),[h,x]=l.useState(e?.details??""),[d,v]=l.useState(e?.importance??1),[p,C]=l.useState(e?.deadline??""),[D,u]=l.useState(e?.completion_time??1),[O,L]=l.useState(e?.unique_days_required??1),[m,U]=l.useState(e?.is_completed??!1),[q,W]=l.useState(e?.completion_comment??""),[w,I]=l.useState(e?.completed_at??null),[f,B]=l.useState({recurrence_type:"none",recurrence_interval:void 0,recurrence_day_of_week:void 0,recurrence_day_of_month:void 0,recurrence_end_date:void 0,is_recurring_template:!1}),F=le(),A=ue(),J=pe(),P=xe(e?.root_category||""),j=!e,S=!!e,R=l.useRef(!1),K=l.useRef(!1),[_,$]=l.useState(!1);l.useEffect(()=>{if(e){y(e.name),x(e.details??""),v(e.importance??1),C(e.deadline??""),u(e.completion_time??1),L(e.unique_days_required??1),U(e.is_completed??!1),W(e.completion_comment??""),I(e.completed_at??null);const i=e.recurrence_type||"none";B({recurrence_type:i,recurrence_interval:i!=="none"?e.recurrence_interval||1:void 0,recurrence_day_of_week:i==="weekly"?e.recurrence_day_of_week:void 0,recurrence_day_of_month:i==="monthly"?e.recurrence_day_of_month:void 0,recurrence_end_date:i!=="none"?e.recurrence_end_date:void 0,is_recurring_template:i!=="none"}),R.current=!1,$(!1)}},[e]),l.useEffect(()=>{e?.id&&J.mutate(String(e.id))},[e?.id]);const X=i=>{U(i),$(!0),i&&!e?.is_completed?I(new Date().toISOString()):!i&&e?.is_completed&&I(null)},Z=async()=>{if(!e)return;if(K.current){console.log("üîÑ Already processing completion, skipping...");return}K.current=!0;const i={id:e.id,is_completed:m,completion_comment:q||void 0,completed_at:w||void 0};console.log("üöÄ Saving task completion:",i),P.mutate(i,{onSuccess:async()=>{if(console.log("‚úÖ Task completion saved successfully"),$(!1),m&&!e.is_completed&&!R.current&&f.recurrence_type!=="none"&&f.recurrence_type){console.log("üîÑ Task completed with recurrence, creating next instance..."),R.current=!0;try{const b={...e,is_completed:!0,completed_at:w||void 0,completion_comment:q,recurrence_type:f.recurrence_type,recurrence_interval:f.recurrence_interval,recurrence_day_of_week:f.recurrence_day_of_week,recurrence_day_of_month:f.recurrence_day_of_month,recurrence_end_date:f.recurrence_end_date,is_recurring_template:f.is_recurring_template},k=await fe(b);k&&console.log("‚úÖ Successfully created recurring instance:",k.name)}catch(b){console.error("‚ùå Failed to create recurring instance:",b),R.current=!1}}m&&r()},onError:b=>{console.error("‚ùå Failed to save task completion:",b),alert(`Failed to save completion: ${b.message}`)},onSettled:()=>{K.current=!1}})},ee=i=>{i.preventDefault();const b=e?.parent_id??s,k=e?.root_category??a,Q=e?.tab_name??o;if(j&&(!b||!k||!Q)){console.error("‚ùå Missing required parent context for new task:",{parentId:b,rootCategory:k,tabName:Q}),alert("Missing parent information. Please try again.");return}const G={id:e?.id,name:c.trim(),details:h.trim()||void 0,importance:d,deadline:p||void 0,completion_time:D,unique_days_required:O,parent_id:b,root_category:k,tab_name:Q,type:"task",...S&&!_&&{is_completed:m,completion_comment:q||void 0,completed_at:w||void 0},...f};console.log("üöÄ Submitting task data:",G),F.mutate(G,{onSuccess:M=>{console.log("‚úÖ Task saved successfully:",M),r()},onError:M=>{console.error("‚ùå Failed to save task:",M),alert(`Failed to save task: ${M.message}`)}})},re=()=>{if(e?.id){if(!confirm(`Are you sure you want to delete "${e.name}"?`))return;console.log("üóëÔ∏è Deleting task:",e.id),A.mutate(e.id,{onSuccess:()=>{console.log("‚úÖ Task deleted successfully"),r()},onError:i=>{console.error("‚ùå Failed to delete task:",i),alert(`Failed to delete task: ${i.message}`)}})}},te=i=>i?new Date(i).toISOString().split("T")[0]:"",Y=()=>S&&e?.root_category?e.root_category:j&&t&&a?`${a} > ${t}`:"Unknown";return n.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-[70] flex items-center justify-center bg-black",children:n.jsxs("form",{onSubmit:ee,className:"mx-4 max-h-[90vh] w-full max-w-md space-y-4 overflow-y-auto rounded-lg bg-white p-6 text-black shadow-md",children:[n.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-xl font-bold",children:j?"Create New Task":"Edit Task"}),n.jsx("p",{className:"text-sm text-gray-600",children:j?`Adding to: ${Y()}`:`Category: ${Y()}`})]}),n.jsx("button",{type:"button",onClick:r,className:"text-2xl font-bold text-gray-500 hover:text-gray-800",children:"√ó"})]}),S&&n.jsxs("div",{className:`mb-6 rounded-lg border p-4 ${m?"border-green-300 bg-green-50":"border-gray-200 bg-gray-50"}`,children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[n.jsxs("label",{className:"flex cursor-pointer items-center font-semibold text-gray-700",children:[n.jsx("input",{type:"checkbox",checked:m,onChange:i=>X(i.target.checked),className:"mr-2 h-5 w-5 cursor-pointer rounded text-green-600 focus:ring-green-500"}),n.jsx("span",{className:m?"text-green-700":"",children:m?"Task Completed":"Mark as Completed"})]}),w&&n.jsx("span",{className:"text-sm text-gray-500",children:new Date(w).toLocaleDateString()})]}),m&&n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Completion Notes (optional):"}),n.jsx("textarea",{className:"w-full rounded border p-2 text-sm text-black focus:border-green-500 focus:ring-2 focus:ring-green-500",rows:3,placeholder:"Add any notes about completing this task...",value:q,onChange:i=>W(i.target.value)}),w&&n.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Completed on ",new Date(w).toLocaleString()]})]}),S&&_&&m&&n.jsxs("div",{className:"mb-4 p-4",children:[n.jsx("button",{type:"button",onClick:Z,disabled:P.isPending,className:"w-full rounded bg-green-600 px-4 py-2 font-semibold text-white hover:bg-green-700 disabled:opacity-50",children:P.isPending?"Saving...":"Save Completed Task"}),n.jsx("p",{className:"mt-2 text-xs text-green-700",children:"Click to save task completion and create next recurring instance (if applicable)"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Task Name *"}),n.jsx("input",{className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",value:c,onChange:i=>y(i.target.value),placeholder:"Enter task name",required:!0,disabled:m&&!_})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Details"}),n.jsx("textarea",{className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",rows:3,value:h,onChange:i=>x(i.target.value),placeholder:"Optional task description",disabled:m&&!_})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Importance (1-10)"}),n.jsx("select",{className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",value:d,onChange:i=>v(Number(i.target.value)),disabled:m&&!_,children:Array.from({length:10},(i,b)=>b+1).map(i=>n.jsxs("option",{value:i,children:["Level ",i]},i))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Deadline"}),n.jsx("input",{type:"date",className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",value:te(p),onChange:i=>C(i.target.value),min:new Date().toISOString().split("T")[0],disabled:m&&!_})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Estimated Completion Time (hours)"}),n.jsx("input",{type:"number",min:"0.5",step:"0.5",className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",value:D,onChange:i=>u(Number(i.target.value)),placeholder:"e.g. 2.5",disabled:m&&!_})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Unique Days Required"}),n.jsx("input",{type:"number",min:"0.5",step:"0.5",className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",value:O,onChange:i=>L(Number(i.target.value)),placeholder:"e.g. 3",disabled:m&&!_}),n.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Number of separate days needed to complete this task"})]}),n.jsx(ye,{initialConfig:{type:f.recurrence_type,interval:f.recurrence_interval||1,dayOfWeek:f.recurrence_day_of_week,dayOfMonth:f.recurrence_day_of_month,endDate:f.recurrence_end_date},onChange:B,disabled:m&&!_,className:"border-t pt-4"}),n.jsxs("div",{className:"flex justify-between border-t pt-4",children:[S&&!(m&&!_)&&n.jsx("button",{type:"button",onClick:re,disabled:A.isPending,className:"rounded bg-red-600 px-4 py-2 text-white hover:bg-red-700 disabled:opacity-50",children:A.isPending?"Deleting...":"Delete Task"}),n.jsxs("div",{className:`${S&&!(m&&!_)?"ml-auto":""} space-x-2`,children:[n.jsx("button",{type:"button",onClick:r,className:"rounded bg-gray-300 px-4 py-2 text-white hover:bg-gray-400",children:"Cancel"}),!(m&&!_)&&n.jsx("button",{type:"submit",disabled:F.isPending||!c.trim(),className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:F.isPending?j?"Creating...":"Saving...":j?"Create Task":"Save Changes"})]})]})]})})}export{g as Q,je as T,T as u};
