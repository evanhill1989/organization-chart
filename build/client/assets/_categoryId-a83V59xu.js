import{a as y,p as a,v as Ue,w as Ke,x as Qe,y as ze}from"./chunk-PVWAREVJ-C9qE2fA-.js";import{u as Q}from"./useQuery-jVOp7vHI.js";import{u as we,k as Ce,Q as qe,a as We}from"./QueryClientProvider-CC2Z6-5f.js";import{g as v}from"./index-DKtf60Sy.js";import{g as Ae,s as J,c as ue,a as Y,u as ve,Q as O,T as z,b as Ge,d as He,e as Ye}from"./TaskForm-zXqqAvTt.js";import{b as ke,f as je,u as Ee,e as Ve,M as Je,D as Xe,T as Ze,Q as et,c as tt,d as rt}from"./MobileHamburgerMenu-CgqagZ5h.js";import{s as D}from"./supabaseClient-Btf0BZYh.js";import{P as st}from"./ProtectedRoute-DvR4G2Fq.js";import"./DarkModeToggle-B8WQ3-QW.js";import"./AuthContext-CtIaUxkA.js";/*!
 * @gsap/react 2.1.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let de=typeof document<"u"?y.useLayoutEffect:y.useEffect,he=e=>e&&!Array.isArray(e)&&typeof e=="object",U=[],nt={},Ne=v;const oe=(e,t=U)=>{let r=nt;he(e)?(r=e,e=null,t="dependencies"in r?r.dependencies:U):he(t)&&(r=t,t="dependencies"in r?r.dependencies:U),e&&typeof e!="function"&&console.warn("First parameter must be a function or config object");const{scope:s,revertOnUpdate:n}=r,o=y.useRef(!1),c=y.useRef(Ne.context(()=>{},s)),l=y.useRef(u=>c.current.add(null,u)),i=t&&t.length&&!n;return i&&de(()=>(o.current=!0,()=>c.current.revert()),U),de(()=>{if(e&&c.current.add(e,s),!i||!o.current)return()=>c.current.revert()},t),{context:c.current,contextSafe:l.current}};oe.register=e=>{Ne=e};oe.headless=!0;function ot(e=1){switch(e){case 1:return"";case 2:return"border-2 border-cyan-400";case 3:return"border-2 border-cyan-500";case 4:return"border-2 border-blue-400";case 5:return"border-2 border-blue-500";case 6:return"border-2 border-indigo-400";case 7:return"border-2 border-indigo-500";case 8:return"border-2 border-purple-400";case 9:return"border-2 border-purple-500";case 10:return"border-2 border-purple-600";default:return""}}function it(e=1){if(e<=1)return"";switch(e){case 2:return"shadow-lg shadow-cyan-400/50";case 3:return"shadow-lg shadow-cyan-500/50";case 4:return"shadow-lg shadow-blue-400/50";case 5:return"shadow-lg shadow-blue-500/50";case 6:return"shadow-lg shadow-indigo-400/50";case 7:return"shadow-lg shadow-indigo-500/50";case 8:return"shadow-lg shadow-purple-400/50";case 9:return"shadow-lg shadow-purple-500/50";case 10:return"shadow-xl shadow-purple-600/75";default:return""}}function Se(e){if(e.type==="task")return e.importance??1;if(!e.children||e.children.length===0)return 1;const t=e.children.map(r=>Se(r));return Math.max(...t)}function ie(e){return Se(e)}function at(e){return!e||e<=1?"rgba(0, 0, 0, 0)":e<=3?"rgba(6, 182, 212, 0.6)":e<=5?"rgba(59, 130, 246, 0.6)":e<=7?"rgba(99, 102, 241, 0.6)":e<=9?"rgba(147, 51, 234, 0.6)":"rgba(126, 34, 206, 0.8)"}function Fe(e,t,r){const s=r?`${r}/${e.name}`:`/${e.name}`;if(Ae(e)<=1)return[];if(e.type==="task")return[s];if(!t[s])return[s];const c=[];if(e.children)for(const l of e.children){const i=Fe(l,t,s);c.push(...i)}return c}function Me(e,t,r){const s=r?`${r}/${e.name}`:`/${e.name}`;if(ie(e)!==10)return null;if(e.type==="task"||!t[s])return s;if(e.children)for(const c of e.children){const l=Me(c,t,s);if(l)return l}return null}function ct({containerRef:e,tree:t,openMap:r,tabName:s,isMobile:n,activePath:o}){oe(()=>{const c=e?.current;if(!c){console.log("ðŸ” GSAP: No container found, skipping animations");return}v.killTweensOf("*"),v.set("*",{clearProps:"all"});const l=setTimeout(()=>{try{n?u():(i(),d())}catch(g){console.error("ðŸš¨ GSAP: Animation error:",g)}},100),i=()=>{const g=new Set;if(t.children)for(const f of t.children)Fe(f,r,`/${s}`).forEach(x=>g.add(x));c.querySelectorAll("[data-urgency-ball]").forEach(f=>{const p=f.getAttribute("data-urgency-ball");if(!p)return;if(!g.has(p)){v.set(f,{opacity:0});return}v.set(f,{opacity:1});const x=c.querySelector(`[data-node-path="${p}"]`);if(!x)return;const C=parseInt(x.getAttribute("data-urgency")||"1");if(J(C))try{const w=ue(x),b=Y(C);v.set(f,{position:"absolute",left:0,top:0,xPercent:-50,yPercent:-50}),v.to(f,{motionPath:{path:w,autoRotate:b.autoRotate,alignOrigin:[.5,.5]},duration:b.duration,ease:b.ease,repeat:b.repeat})}catch(w){console.error(`ðŸš¨ GSAP: Failed animating ball for ${p}`,w)}})},u=()=>{c.querySelectorAll("[data-urgency-ball]").forEach(h=>{const f=h.getAttribute("data-urgency-ball");if(!f)return;const p=c.querySelector(`[data-node-path="${f}"]`);if(!p){v.set(h,{opacity:0});return}const x=parseInt(p.getAttribute("data-urgency")||"1");if(!J(x)){v.set(h,{opacity:0});return}try{v.set(h,{opacity:1});const C=ue(p),w=Y(x);v.set(h,{position:"absolute",left:0,top:0,xPercent:-50,yPercent:-50}),v.to(h,{motionPath:{path:C,autoRotate:w.autoRotate,alignOrigin:[.5,.5]},duration:w.duration,ease:w.ease,repeat:w.repeat})}catch(C){console.error(`ðŸš¨ GSAP: Failed animating mobile ball for ${f}`,C),v.set(h,{position:"absolute",left:"50%",top:"0px",xPercent:-50,yPercent:-50}),v.to(h,{rotation:360,duration:Y(x).duration,repeat:-1,ease:"none",transformOrigin:"50% 100px"})}})},d=()=>{if(t.children)for(const g of t.children){const h=Me(g,r,`/${s}`);if(!h)continue;const f=c.querySelector(`[data-node-path="${h}"]`);if(!f)continue;const p=ie(g),x=at(p);v.set(f,{boxShadow:`0 0 20px ${x}`}),v.to(f,{scale:1.03,duration:1.2,ease:"power2.inOut",yoyo:!0,repeat:-1})}};return()=>{clearTimeout(l),v.killTweensOf("*"),v.set("*",{clearProps:"all"})}},{scope:e,dependencies:[t,r,s,n,o],revertOnUpdate:!0})}function De(e,t,r="",s){const n=r?`${r}/${e.name}`:`/${s}`;if(e.children){for(const o of e.children)if(`${n}/${o.name}`===t)return e.children.map(l=>`${n}/${l.name}`);for(const o of e.children){const c=De(o,t,n,s);if(c.length>0)return c}}return[]}function lt(e,t,r){return y.useCallback(s=>{r(n=>{const o={...n};return n[s]?Object.keys(n).filter(i=>i.startsWith(s+"/")||i===s).forEach(i=>{o[i]=!1}):(De(e,s,"",t).forEach(i=>{i!==s&&(o[i]=!1,Object.keys(n).forEach(u=>{u.startsWith(i+"/")&&(o[u]=!1)}))}),o[s]=!0),o})},[e,t,r])}const ut=()=>{const e=we();return ve({mutationFn:async t=>{const{data:{user:r}}=await D.auth.getUser();if(!r)throw new Error("User not authenticated");if(t.id){const{data:s,error:n}=await D.from("org_nodes").update({...t,type:"category"}).eq("id",t.id).eq("user_id",r.id).select().single();if(n)throw n;return s}else{const{data:s,error:n}=await D.from("org_nodes").insert({...t,type:"category",user_id:r.id}).select().single();if(n)throw n;return s}},onSuccess:t=>{e.setQueryData(O.category(t.id),t),e.invalidateQueries({queryKey:O.allOrgTrees()})},onError:t=>{console.error("âŒ Save category error:",t)}})},dt=()=>{const e=we();return ve({mutationFn:async t=>{const{data:{user:r}}=await D.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:s}=await D.from("org_nodes").delete().eq("id",t).eq("user_id",r.id);if(s)throw s;return t},onSuccess:t=>{e.removeQueries({queryKey:O.category(t)}),e.invalidateQueries({queryKey:O.allOrgTrees()})},onError:t=>{console.error("âŒ Delete category error:",t)}})};function fe({category:e,onCancel:t,parentId:r,parentName:s,categoryId:n,categoryName:o}){const[c,l]=y.useState(e?.name??""),i=ut(),u=dt(),d=!e,g=!!e;y.useEffect(()=>{e&&l(e.name)},[e]);const h=()=>g&&o?o:d&&s&&o?`${o} > ${s}`:"Unknown",f=x=>{x.preventDefault();const C=e?.parent_id??r,w=e?.category_id??n;if(d&&(!C||!w)){console.error("âŒ Missing required parent context for new category:",{parentId:C,categoryId:w}),alert("Missing parent information. Please try again.");return}const b={id:e?.id,name:c.trim(),parent_id:C,category_id:w,type:"category"};console.log("ðŸš€ Submitting category data:",b),i.mutate(b,{onSuccess:A=>{console.log("âœ… Category saved successfully:",A),t()},onError:A=>{console.error("âŒ Failed to save category:",A),alert(`Failed to save category: ${A.message}`)}})},p=()=>{if(e?.id){if(!confirm(`Are you sure you want to delete "${e.name}"?`))return;console.log("ðŸ—‘ï¸ Deleting category:",e.id),u.mutate(e.id,{onSuccess:()=>{console.log("âœ… Category deleted successfully"),t()},onError:x=>{console.error("âŒ Failed to delete category:",x),alert(`Failed to delete category: ${x.message}`)}})}};return a.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-[70] flex items-center justify-center bg-black",children:a.jsxs("form",{onSubmit:f,className:"mx-4 max-h-[90vh] w-full max-w-md space-y-4 overflow-y-auto rounded-lg bg-white p-6 text-black shadow-md",children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold",children:d?"Create New Category":"Edit Category"}),a.jsx("p",{className:"text-sm text-gray-600",children:d?`Adding to: ${h()}`:`Location: ${h()}`})]}),a.jsx("button",{type:"button",onClick:t,className:"text-2xl font-bold text-gray-500 hover:text-gray-800",children:"Ã—"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Category Name *"}),a.jsx("input",{className:"w-full rounded border border-gray-300 p-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-500",value:c,onChange:x=>l(x.target.value),placeholder:"Enter category name",required:!0})]}),a.jsxs("div",{className:"flex justify-between border-t pt-4",children:[g&&a.jsx("button",{type:"button",onClick:p,disabled:u.isPending,className:"rounded bg-red-600 px-4 py-2 text-white hover:bg-red-700 disabled:opacity-50",children:u.isPending?"Deleting...":"Delete Category"}),a.jsxs("div",{className:`${g?"ml-auto":""} space-x-2`,children:[a.jsx("button",{type:"button",onClick:t,className:"rounded bg-gray-300 px-4 py-2 text-white hover:bg-gray-400",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:i.isPending||!c.trim(),className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:i.isPending?d?"Creating...":"Saving...":d?"Create Category":"Save Changes"})]})]})]})})}function q({node:e,level:t=0,onTaskClick:r,openMap:s,toggleOpen:n,path:o,disableExpand:c,isRoot:l=!1,categoryId:i,categoryName:u}){const d=e.type==="task",g=s[o]||!1,[h,f]=y.useState(!1),[p,x]=y.useState(!1),[C,w]=y.useState(!1),b=Ae(e),A=ie(e),k=()=>f(!1),M=()=>x(!1);return l?a.jsxs("div",{className:"grid auto-cols-min grid-flow-col gap-8",children:[a.jsx("h2",{className:"mb-8 text-center text-3xl font-bold text-gray-900 dark:text-gray-100",children:e.name}),e.children&&e.children.length>0?a.jsx("div",{className:"node-with-children",children:e.children.map(N=>a.jsx(q,{node:N,level:t+1,onTaskClick:r,openMap:s,toggleOpen:n,path:`${o}/${N.name}`,disableExpand:c,isRoot:!1,categoryId:i||e.category_id,categoryName:u||e.name},N.id))}):a.jsx("div",{className:"py-12 text-center",children:a.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"No items in this category yet."})}),h&&a.jsx(z,{parentId:e.id,parentName:e.name,categoryId:i||e.category_id,tabName:u||e.name,onCancel:k}),p&&a.jsx(fe,{parentId:e.id,parentName:e.name,categoryId:i||e.category_id,tabName:u||e.name,onCancel:k})]}):a.jsxs("div",{className:"flex w-full flex-col items-center",children:[a.jsxs("div",{"data-node-path":o,"data-urgency":b,className:`relative min-w-[120px] rounded-lg bg-white text-center shadow-amber-600 outline outline-gray-400 ${e.is_completed?"bg-green-50 opacity-60":""} ${ot(A)} ${it(A)}`,children:[!e.is_completed&&J(b)&&a.jsx("div",{className:`pointer-events-none absolute z-10 rounded-full ${Ge(b)} ${He(b)} ${Ye(b)}`,"data-urgency-ball":o,style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),d?a.jsxs("button",{className:`h-full w-full rounded-lg p-2 text-lg font-semibold underline hover:text-blue-200 focus:outline-none ${e.is_completed?"bg-green-600 text-white line-through":"bg-blue-600 text-white"}`,onClick:()=>r(e),children:[e.name,e.is_completed&&a.jsx("span",{className:"ml-2 text-xs",children:"âœ“"})]}):a.jsx("button",{className:"w-full rounded-lg bg-gray-800 p-2 text-center text-lg font-semibold text-white focus:outline-none",onClick:()=>!c&&n(o),type:"button",disabled:c,children:a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.name,!c&&a.jsx("span",{className:"ml-1 text-gray-400",children:g?"â–¼":"â–¶"})]})})]}),!d&&g&&!c&&a.jsxs("div",{className:"mt-4 grid w-full auto-cols-min grid-flow-col gap-4",children:[e.children?.map(N=>a.jsx(q,{node:N,level:t+1,onTaskClick:r,openMap:s,toggleOpen:n,path:`${o}/${N.name}`,disableExpand:c,isRoot:!1,categoryId:i,categoryName:u},N.id)),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-600 text-xl font-bold text-white hover:bg-blue-700",onClick:()=>f(!0),title:"Add Task",type:"button",children:"+"}),a.jsx("button",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-green-600 text-xl font-bold text-white hover:bg-green-700",onClick:()=>x(!0),title:"Add Category",type:"button",children:"ðŸ“"}),(!e.children||e.children.length===0)&&a.jsx("button",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-red-600 text-xl font-bold text-white hover:bg-red-700",onClick:()=>{w(!0)},title:"Delete Category",type:"button",children:"ðŸ—‘ï¸"})]})]}),h&&a.jsx(z,{parentId:e.id,parentName:e.name,categoryId:i,tabName:u,onCancel:k}),C&&a.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-[70] flex items-center justify-center bg-black",children:a.jsxs("div",{className:"mx-4 max-w-sm rounded-lg bg-white p-6 text-black",children:[a.jsx("h3",{className:"mb-4 text-lg font-bold",children:"Delete Category"}),a.jsxs("p",{className:"mb-4",children:['Are you sure you want to delete "',e.name,'"?']}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>w(!1),className:"rounded bg-gray-300 px-4 py-2 hover:bg-gray-400",children:"Cancel"}),a.jsx("button",{onClick:()=>{w(!1)},className:"rounded bg-red-600 px-4 py-2 text-white hover:bg-red-700",children:"Delete"})]})]})}),p&&a.jsx(fe,{parentId:e.id,parentName:e.name,categoryId:i,tabName:u,onCancel:M})]})}function ht({currentNode:e,activePath:t,setActivePath:r,onTaskClick:s,categoryId:n,categoryName:o}){const[c,l]=y.useState(!1),i=h=>{const f=`${t}/${h.name}`;console.log(`Mobile: navigating forward to ${f}`),r(f)},u=()=>{const h=t.split("/").slice(0,-1).join("/")||`/${o}`;console.log(`Mobile: navigating back to ${h}`),r(h)},d=()=>l(!1),g=()=>{if(!t||typeof t!="string")return console.warn("MobileOrgChart: activePath is undefined or not a string:",t),o;try{return t.replace(`/${o}`,o).replace(/\//g," â†’ ")}catch(h){return console.error("Error generating breadcrumb:",h),o}};return t?a.jsxs("div",{className:"mx-auto flex w-full max-w-md flex-col p-4",children:[a.jsx("h2",{className:"mb-4 text-center text-2xl font-bold text-gray-900 dark:text-gray-100",children:o}),a.jsx("div",{className:"mb-2 text-sm text-gray-600 dark:text-gray-400",children:g()}),t!==`/${o}`&&a.jsx("button",{onClick:u,className:"mb-4 text-left font-semibold text-blue-600 transition-colors hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"â† Back"}),e.type==="category"&&a.jsx("div",{className:"mb-4 flex justify-center",children:a.jsxs("button",{className:"flex items-center justify-center space-x-2 rounded-lg bg-blue-600 px-4 py-3 font-semibold text-white shadow-lg transition-colors hover:bg-blue-700 active:bg-blue-800",onClick:()=>l(!0),title:"Add new task or category",type:"button",children:[a.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),a.jsx("span",{children:"Add Task"})]})}),a.jsxs("div",{className:"flex flex-col gap-4",children:[e.children?.map(h=>{const f=`${t}/${h.name}`;return a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsx("div",{className:"flex-1",children:a.jsx(q,{node:h,level:1,onTaskClick:s,openMap:{},toggleOpen:()=>{},path:f,disableExpand:!0,isRoot:!1})}),!h.is_completed&&h.children?.length?a.jsx("button",{onClick:()=>i(h),className:"flex-shrink-0 rounded border border-blue-600 px-3 py-1 text-sm text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-800 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-300",children:"Enter â†’"}):null]},f)}),!e.children?.length&&a.jsxs("div",{className:"py-8 text-center text-gray-500 dark:text-gray-400",children:["No items in this category",e.type==="category"&&a.jsx("div",{className:"mt-4",children:a.jsx("button",{className:"rounded-lg bg-blue-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-blue-700",onClick:()=>l(!0),children:"Add First Task"})})]})]}),c&&a.jsx(z,{parentId:e.id,parentName:e.name,categoryId:n,categoryName:o,onCancel:d})]}):(console.error("MobileOrgChart: activePath is required but was:",t),a.jsx("div",{className:"mx-auto flex w-full max-w-md flex-col p-4",children:a.jsx("div",{className:"py-8 text-center text-red-600",children:"Navigation error: Invalid path"})}))}const ft=(e,t)=>{const r=t.split("/").filter(Boolean);if(!r.length)return e;let s=e;for(let n=1;n<r.length;n++)if(!s?.children||(s=s.children.find(o=>o.name===r[n]),!s))return null;return s||null};function gt({categoryId:e}){const t=y.useRef(null),r=ke(),[s,n]=y.useState({}),[o,c]=y.useState(null),{data:l}=Q({queryKey:["category",e],queryFn:async()=>{const{data:{user:b}}=await D.auth.getUser();if(!b)throw new Error("User not authenticated");const{data:A,error:k}=await D.from("categories").select("id, name").eq("id",e).eq("user_id",b.id).single();if(k)throw k;return A},enabled:!!e}),i=l?.name||"",[u,d]=y.useState(`/${i}`);y.useEffect(()=>{i&&d(`/${i}`)},[i]);const{data:g,isLoading:h,error:f}=Q({queryKey:O.orgTree(e),queryFn:()=>je(e),placeholderData:Ce,enabled:!!e}),p=lt(g||{},i,n);ct({containerRef:t,tree:g||{},openMap:s,tabName:i,isMobile:r,activePath:r?u:void 0});const x=b=>c(b),C=()=>c(null);if(h||!l)return a.jsxs("div",{className:"py-8 text-center text-gray-900 dark:text-gray-100",children:["Loading ",i||"category"," tree..."]});if(f)return a.jsxs("div",{className:"py-8 text-center text-red-600 dark:text-red-400",children:["Error loading ",i," tree"]});if(!g)return a.jsx("div",{className:"py-8 text-center text-gray-900 dark:text-gray-100",children:"No data found"});const w=r?ft(g,u):null;return a.jsxs(a.Fragment,{children:[a.jsx("div",{ref:t,className:"relative flex h-full w-full items-start p-4",children:r?w&&u?a.jsx(ht,{root:g,currentNode:w,activePath:u,setActivePath:d,onTaskClick:x,tabName:i}):a.jsxs("div",{className:"py-8 text-center text-red-600",children:["Navigation error: Node not found",a.jsxs("div",{className:"mt-2 text-sm",children:["Category: ",i,", Path: ",u||"undefined"]})]}):a.jsx(q,{node:g,level:0,onTaskClick:x,openMap:s,toggleOpen:p,path:`/${i}`,isRoot:!0,categoryId:e,categoryName:i})}),o&&a.jsx(z,{task:o,onCancel:C})]})}async function mt(){const{data:{user:e}}=await D.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:t,error:r}=await D.from("org_nodes").select("*").eq("user_id",e.id).not("is_completed","is",!0);if(r)throw r;return t||[]}function pt(){return Q({queryKey:["allNodes"],queryFn:mt,staleTime:1e3*60*5})}function B(e){return Array.isArray?Array.isArray(e):_e(e)==="[object Array]"}function xt(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function yt(e){return e==null?"":xt(e)}function F(e){return typeof e=="string"}function Be(e){return typeof e=="number"}function bt(e){return e===!0||e===!1||wt(e)&&_e(e)=="[object Boolean]"}function Te(e){return typeof e=="object"}function wt(e){return Te(e)&&e!==null}function j(e){return e!=null}function V(e){return!e.trim().length}function _e(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const Ct="Incorrect 'index' type",At=e=>`Invalid value for key ${e}`,vt=e=>`Pattern length exceeds max of ${e}.`,kt=e=>`Missing ${e} property in key`,jt=e=>`Property 'weight' in key '${e}' must be a positive integer`,ge=Object.prototype.hasOwnProperty;class Et{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(s=>{let n=Ie(s);this._keys.push(n),this._keyMap[n.id]=n,r+=n.weight}),this._keys.forEach(s=>{s.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Ie(e){let t=null,r=null,s=null,n=1,o=null;if(F(e)||B(e))s=e,t=me(e),r=X(e);else{if(!ge.call(e,"name"))throw new Error(kt("name"));const c=e.name;if(s=c,ge.call(e,"weight")&&(n=e.weight,n<=0))throw new Error(jt(c));t=me(c),r=X(c),o=e.getFn}return{path:t,id:r,weight:n,src:s,getFn:o}}function me(e){return B(e)?e:e.split(".")}function X(e){return B(e)?e.join("."):e}function Nt(e,t){let r=[],s=!1;const n=(o,c,l)=>{if(j(o))if(!c[l])r.push(o);else{let i=c[l];const u=o[i];if(!j(u))return;if(l===c.length-1&&(F(u)||Be(u)||bt(u)))r.push(yt(u));else if(B(u)){s=!0;for(let d=0,g=u.length;d<g;d+=1)n(u[d],c,l+1)}else c.length&&n(u,c,l+1)}};return n(e,F(t)?t.split("."):t,0),s?r:r[0]}const St={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Ft={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},Mt={location:0,threshold:.6,distance:100},Dt={useExtendedSearch:!1,getFn:Nt,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var m={...Ft,...St,...Mt,...Dt};const Bt=/[^ ]+/g;function Tt(e=1,t=3){const r=new Map,s=Math.pow(10,t);return{get(n){const o=n.match(Bt).length;if(r.has(o))return r.get(o);const c=1/Math.pow(o,.5*e),l=parseFloat(Math.round(c*s)/s);return r.set(o,l),l},clear(){r.clear()}}}class ae{constructor({getFn:t=m.getFn,fieldNormWeight:r=m.fieldNormWeight}={}){this.norm=Tt(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,s)=>{this._keysMap[r.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,F(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){const r=this.size();F(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,s=this.size();r<s;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!j(t)||V(t))return;let s={v:t,i:r,n:this.norm.get(t)};this.records.push(s)}_addObject(t,r){let s={i:r,$:{}};this.keys.forEach((n,o)=>{let c=n.getFn?n.getFn(t):this.getFn(t,n.path);if(j(c)){if(B(c)){let l=[];const i=[{nestedArrIndex:-1,value:c}];for(;i.length;){const{nestedArrIndex:u,value:d}=i.pop();if(j(d))if(F(d)&&!V(d)){let g={v:d,i:u,n:this.norm.get(d)};l.push(g)}else B(d)&&d.forEach((g,h)=>{i.push({nestedArrIndex:h,value:g})})}s.$[o]=l}else if(F(c)&&!V(c)){let l={v:c,n:this.norm.get(c)};s.$[o]=l}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function $e(e,t,{getFn:r=m.getFn,fieldNormWeight:s=m.fieldNormWeight}={}){const n=new ae({getFn:r,fieldNormWeight:s});return n.setKeys(e.map(Ie)),n.setSources(t),n.create(),n}function _t(e,{getFn:t=m.getFn,fieldNormWeight:r=m.fieldNormWeight}={}){const{keys:s,records:n}=e,o=new ae({getFn:t,fieldNormWeight:r});return o.setKeys(s),o.setIndexRecords(n),o}function K(e,{errors:t=0,currentLocation:r=0,expectedLocation:s=0,distance:n=m.distance,ignoreLocation:o=m.ignoreLocation}={}){const c=t/e.length;if(o)return c;const l=Math.abs(s-r);return n?c+l/n:l?1:c}function It(e=[],t=m.minMatchCharLength){let r=[],s=-1,n=-1,o=0;for(let c=e.length;o<c;o+=1){let l=e[o];l&&s===-1?s=o:!l&&s!==-1&&(n=o-1,n-s+1>=t&&r.push([s,n]),s=-1)}return e[o-1]&&o-s>=t&&r.push([s,o-1]),r}const $=32;function $t(e,t,r,{location:s=m.location,distance:n=m.distance,threshold:o=m.threshold,findAllMatches:c=m.findAllMatches,minMatchCharLength:l=m.minMatchCharLength,includeMatches:i=m.includeMatches,ignoreLocation:u=m.ignoreLocation}={}){if(t.length>$)throw new Error(vt($));const d=t.length,g=e.length,h=Math.max(0,Math.min(s,g));let f=o,p=h;const x=l>1||i,C=x?Array(g):[];let w;for(;(w=e.indexOf(t,p))>-1;){let E=K(t,{currentLocation:w,expectedLocation:h,distance:n,ignoreLocation:u});if(f=Math.min(E,f),p=w+d,x){let T=0;for(;T<d;)C[w+T]=1,T+=1}}p=-1;let b=[],A=1,k=d+g;const M=1<<d-1;for(let E=0;E<d;E+=1){let T=0,_=k;for(;T<_;)K(t,{errors:E,currentLocation:h+_,expectedLocation:h,distance:n,ignoreLocation:u})<=f?T=_:k=_,_=Math.floor((k-T)/2+T);k=_;let ce=Math.max(1,h-_+1),H=c?g:Math.min(h+_,g)+d,R=Array(H+2);R[H+1]=(1<<E)-1;for(let S=H;S>=ce;S-=1){let P=S-1,le=r[e.charAt(P)];if(x&&(C[P]=+!!le),R[S]=(R[S+1]<<1|1)&le,E&&(R[S]|=(b[S+1]|b[S])<<1|1|b[S+1]),R[S]&M&&(A=K(t,{errors:E,currentLocation:P,expectedLocation:h,distance:n,ignoreLocation:u}),A<=f)){if(f=A,p=P,p<=h)break;ce=Math.max(1,2*h-p)}}if(K(t,{errors:E+1,currentLocation:h,expectedLocation:h,distance:n,ignoreLocation:u})>f)break;b=R}const N={isMatch:p>=0,score:Math.max(.001,A)};if(x){const E=It(C,l);E.length?i&&(N.indices=E):N.isMatch=!1}return N}function Rt(e){let t={};for(let r=0,s=e.length;r<s;r+=1){const n=e.charAt(r);t[n]=(t[n]||0)|1<<s-r-1}return t}const W=String.prototype.normalize?(e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(e=>e);class Re{constructor(t,{location:r=m.location,threshold:s=m.threshold,distance:n=m.distance,includeMatches:o=m.includeMatches,findAllMatches:c=m.findAllMatches,minMatchCharLength:l=m.minMatchCharLength,isCaseSensitive:i=m.isCaseSensitive,ignoreDiacritics:u=m.ignoreDiacritics,ignoreLocation:d=m.ignoreLocation}={}){if(this.options={location:r,threshold:s,distance:n,includeMatches:o,findAllMatches:c,minMatchCharLength:l,isCaseSensitive:i,ignoreDiacritics:u,ignoreLocation:d},t=i?t:t.toLowerCase(),t=u?W(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;const g=(f,p)=>{this.chunks.push({pattern:f,alphabet:Rt(f),startIndex:p})},h=this.pattern.length;if(h>$){let f=0;const p=h%$,x=h-p;for(;f<x;)g(this.pattern.substr(f,$),f),f+=$;if(p){const C=h-$;g(this.pattern.substr(C),C)}}else g(this.pattern,0)}searchIn(t){const{isCaseSensitive:r,ignoreDiacritics:s,includeMatches:n}=this.options;if(t=r?t:t.toLowerCase(),t=s?W(t):t,this.pattern===t){let x={isMatch:!0,score:0};return n&&(x.indices=[[0,t.length-1]]),x}const{location:o,distance:c,threshold:l,findAllMatches:i,minMatchCharLength:u,ignoreLocation:d}=this.options;let g=[],h=0,f=!1;this.chunks.forEach(({pattern:x,alphabet:C,startIndex:w})=>{const{isMatch:b,score:A,indices:k}=$t(t,x,C,{location:o+w,distance:c,threshold:l,findAllMatches:i,minMatchCharLength:u,includeMatches:n,ignoreLocation:d});b&&(f=!0),h+=A,b&&k&&(g=[...g,...k])});let p={isMatch:f,score:f?h/this.chunks.length:1};return f&&n&&(p.indices=g),p}}class I{constructor(t){this.pattern=t}static isMultiMatch(t){return pe(t,this.multiRegex)}static isSingleMatch(t){return pe(t,this.singleRegex)}search(){}}function pe(e,t){const r=e.match(t);return r?r[1]:null}class Ot extends I{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class Lt extends I{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const s=t.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,t.length-1]}}}class Pt extends I{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class Ut extends I{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Kt extends I{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class Qt extends I{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Oe extends I{constructor(t,{location:r=m.location,threshold:s=m.threshold,distance:n=m.distance,includeMatches:o=m.includeMatches,findAllMatches:c=m.findAllMatches,minMatchCharLength:l=m.minMatchCharLength,isCaseSensitive:i=m.isCaseSensitive,ignoreDiacritics:u=m.ignoreDiacritics,ignoreLocation:d=m.ignoreLocation}={}){super(t),this._bitapSearch=new Re(t,{location:r,threshold:s,distance:n,includeMatches:o,findAllMatches:c,minMatchCharLength:l,isCaseSensitive:i,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Le extends I{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,s;const n=[],o=this.pattern.length;for(;(s=t.indexOf(this.pattern,r))>-1;)r=s+o,n.push([s,r-1]);const c=!!n.length;return{isMatch:c,score:c?0:1,indices:n}}}const Z=[Ot,Le,Pt,Ut,Qt,Kt,Lt,Oe],xe=Z.length,zt=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,qt="|";function Wt(e,t={}){return e.split(qt).map(r=>{let s=r.trim().split(zt).filter(o=>o&&!!o.trim()),n=[];for(let o=0,c=s.length;o<c;o+=1){const l=s[o];let i=!1,u=-1;for(;!i&&++u<xe;){const d=Z[u];let g=d.isMultiMatch(l);g&&(n.push(new d(g,t)),i=!0)}if(!i)for(u=-1;++u<xe;){const d=Z[u];let g=d.isSingleMatch(l);if(g){n.push(new d(g,t));break}}}return n})}const Gt=new Set([Oe.type,Le.type]);class Ht{constructor(t,{isCaseSensitive:r=m.isCaseSensitive,ignoreDiacritics:s=m.ignoreDiacritics,includeMatches:n=m.includeMatches,minMatchCharLength:o=m.minMatchCharLength,ignoreLocation:c=m.ignoreLocation,findAllMatches:l=m.findAllMatches,location:i=m.location,threshold:u=m.threshold,distance:d=m.distance}={}){this.query=null,this.options={isCaseSensitive:r,ignoreDiacritics:s,includeMatches:n,minMatchCharLength:o,findAllMatches:l,ignoreLocation:c,location:i,threshold:u,distance:d},t=r?t:t.toLowerCase(),t=s?W(t):t,this.pattern=t,this.query=Wt(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){const r=this.query;if(!r)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:n,ignoreDiacritics:o}=this.options;t=n?t:t.toLowerCase(),t=o?W(t):t;let c=0,l=[],i=0;for(let u=0,d=r.length;u<d;u+=1){const g=r[u];l.length=0,c=0;for(let h=0,f=g.length;h<f;h+=1){const p=g[h],{isMatch:x,indices:C,score:w}=p.search(t);if(x){if(c+=1,i+=w,s){const b=p.constructor.type;Gt.has(b)?l=[...l,...C]:l.push(C)}}else{i=0,c=0,l.length=0;break}}if(c){let h={isMatch:!0,score:i/c};return s&&(h.indices=l),h}}return{isMatch:!1,score:1}}}const ee=[];function Yt(...e){ee.push(...e)}function te(e,t){for(let r=0,s=ee.length;r<s;r+=1){let n=ee[r];if(n.condition(e,t))return new n(e,t)}return new Re(e,t)}const G={AND:"$and",OR:"$or"},re={PATH:"$path",PATTERN:"$val"},se=e=>!!(e[G.AND]||e[G.OR]),Vt=e=>!!e[re.PATH],Jt=e=>!B(e)&&Te(e)&&!se(e),ye=e=>({[G.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function Pe(e,t,{auto:r=!0}={}){const s=n=>{let o=Object.keys(n);const c=Vt(n);if(!c&&o.length>1&&!se(n))return s(ye(n));if(Jt(n)){const i=c?n[re.PATH]:o[0],u=c?n[re.PATTERN]:n[i];if(!F(u))throw new Error(At(i));const d={keyId:X(i),pattern:u};return r&&(d.searcher=te(u,t)),d}let l={children:[],operator:o[0]};return o.forEach(i=>{const u=n[i];B(u)&&u.forEach(d=>{l.children.push(s(d))})}),l};return se(e)||(e=ye(e)),s(e)}function Xt(e,{ignoreFieldNorm:t=m.ignoreFieldNorm}){e.forEach(r=>{let s=1;r.matches.forEach(({key:n,norm:o,score:c})=>{const l=n?n.weight:null;s*=Math.pow(c===0&&l?Number.EPSILON:c,(l||1)*(t?1:o))}),r.score=s})}function Zt(e,t){const r=e.matches;t.matches=[],j(r)&&r.forEach(s=>{if(!j(s.indices)||!s.indices.length)return;const{indices:n,value:o}=s;let c={indices:n,value:o};s.key&&(c.key=s.key.src),s.idx>-1&&(c.refIndex=s.idx),t.matches.push(c)})}function er(e,t){t.score=e.score}function tr(e,t,{includeMatches:r=m.includeMatches,includeScore:s=m.includeScore}={}){const n=[];return r&&n.push(Zt),s&&n.push(er),e.map(o=>{const{idx:c}=o,l={item:t[c],refIndex:c};return n.length&&n.forEach(i=>{i(o,l)}),l})}class L{constructor(t,r={},s){this.options={...m,...r},this.options.useExtendedSearch,this._keyStore=new Et(this.options.keys),this.setCollection(t,s)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof ae))throw new Error(Ct);this._myIndex=r||$e(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){j(t)&&(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const r=[];for(let s=0,n=this._docs.length;s<n;s+=1){const o=this._docs[s];t(o,s)&&(this.removeAt(s),s-=1,n-=1,r.push(o))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){const{includeMatches:s,includeScore:n,shouldSort:o,sortFn:c,ignoreFieldNorm:l}=this.options;let i=F(t)?F(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return Xt(i,{ignoreFieldNorm:l}),o&&i.sort(c),Be(r)&&r>-1&&(i=i.slice(0,r)),tr(i,this._docs,{includeMatches:s,includeScore:n})}_searchStringList(t){const r=te(t,this.options),{records:s}=this._myIndex,n=[];return s.forEach(({v:o,i:c,n:l})=>{if(!j(o))return;const{isMatch:i,score:u,indices:d}=r.searchIn(o);i&&n.push({item:o,idx:c,matches:[{score:u,value:o,norm:l,indices:d}]})}),n}_searchLogical(t){const r=Pe(t,this.options),s=(l,i,u)=>{if(!l.children){const{keyId:g,searcher:h}=l,f=this._findMatches({key:this._keyStore.get(g),value:this._myIndex.getValueForItemAtKeyId(i,g),searcher:h});return f&&f.length?[{idx:u,item:i,matches:f}]:[]}const d=[];for(let g=0,h=l.children.length;g<h;g+=1){const f=l.children[g],p=s(f,i,u);if(p.length)d.push(...p);else if(l.operator===G.AND)return[]}return d},n=this._myIndex.records,o={},c=[];return n.forEach(({$:l,i})=>{if(j(l)){let u=s(r,l,i);u.length&&(o[i]||(o[i]={idx:i,item:l,matches:[]},c.push(o[i])),u.forEach(({matches:d})=>{o[i].matches.push(...d)}))}}),c}_searchObjectList(t){const r=te(t,this.options),{keys:s,records:n}=this._myIndex,o=[];return n.forEach(({$:c,i:l})=>{if(!j(c))return;let i=[];s.forEach((u,d)=>{i.push(...this._findMatches({key:u,value:c[d],searcher:r}))}),i.length&&o.push({idx:l,item:c,matches:i})}),o}_findMatches({key:t,value:r,searcher:s}){if(!j(r))return[];let n=[];if(B(r))r.forEach(({v:o,i:c,n:l})=>{if(!j(o))return;const{isMatch:i,score:u,indices:d}=s.searchIn(o);i&&n.push({score:u,key:t,value:o,idx:c,norm:l,indices:d})});else{const{v:o,n:c}=r,{isMatch:l,score:i,indices:u}=s.searchIn(o);l&&n.push({score:i,key:t,value:o,norm:c,indices:u})}return n}}L.version="7.1.0";L.createIndex=$e;L.parseIndex=_t;L.config=m;L.parseQuery=Pe;Yt(Ht);function rr(e,t,r){const s=[];let n=e;for(;n;)if(s.unshift(n.name),n.parent_id)n=t.find(o=>o.id===n.parent_id);else{const o=r.find(c=>c.id===n?.category_id);o&&s.unshift(o.name);break}return s}function sr(e){return new L(e,{keys:[{name:"name",weight:2},{name:"details",weight:1}],threshold:.4,includeScore:!0,minMatchCharLength:2})}function nr(e,t,r,s=20){return e.trim()?sr(t).search(e).slice(0,s).map(l=>({node:l.item,path:rr(l.item,t,r),categoryId:l.item.category_id,score:l.score})).sort((l,i)=>l.node.type==="category"&&i.node.type!=="category"?-1:l.node.type!=="category"&&i.node.type==="category"?1:(l.score||0)-(i.score||0)):[]}function or({results:e,onSelectResult:t,isVisible:r}){const[s,n]=y.useState(0),o=y.useRef(null);if(y.useEffect(()=>{n(0)},[e]),y.useEffect(()=>{if(!r)return;const i=u=>{u.key==="ArrowDown"?(u.preventDefault(),n(d=>d<e.length-1?d+1:d)):u.key==="ArrowUp"?(u.preventDefault(),n(d=>d>0?d-1:0)):u.key==="Enter"&&(u.preventDefault(),e[s]&&t(e[s]))};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[r,e,s,t]),y.useEffect(()=>{if(!o.current)return;o.current.children[s]?.scrollIntoView({block:"nearest",behavior:"smooth"})},[s]),!r||e.length===0)return null;const c=e.filter(i=>i.node.type==="category"),l=e.filter(i=>i.node.type==="task");return a.jsxs("div",{ref:o,className:"absolute left-0 right-0 top-full z-50 mt-2 max-h-[400px] overflow-y-auto rounded-lg border border-gray-700/50 bg-gray-900/95 shadow-2xl backdrop-blur-sm dark:border-gray-600/50 dark:bg-gray-800/95",children:[c.length>0&&a.jsxs("div",{children:[a.jsx("div",{className:"sticky top-0 bg-gray-800/90 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-400",children:"Categories"}),c.map(i=>{const u=e.indexOf(i);return a.jsx(be,{result:i,isSelected:u===s,onClick:()=>t(i)},i.node.id)})]}),l.length>0&&a.jsxs("div",{children:[a.jsx("div",{className:"sticky top-0 bg-gray-800/90 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-400",children:"Tasks"}),l.map(i=>{const u=e.indexOf(i);return a.jsx(be,{result:i,isSelected:u===s,onClick:()=>t(i)},i.node.id)})]}),e.length===0&&a.jsx("div",{className:"px-4 py-8 text-center text-sm text-gray-400",children:"No results found"})]})}function be({result:e,isSelected:t,onClick:r}){const{node:s,path:n}=e,o=n.slice(0,-1).join(" â†’ ");return a.jsx("button",{onClick:r,className:`w-full border-b border-gray-700/30 px-4 py-3 text-left transition-colors dark:border-gray-600/30 ${t?"bg-blue-600/30 dark:bg-blue-700/30":"hover:bg-gray-800/60 dark:hover:bg-gray-700/60"}`,children:a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-gray-100 dark:text-gray-200",children:s.name}),o&&a.jsx("div",{className:"mt-1 truncate text-xs text-gray-400 dark:text-gray-500",children:o}),s.details&&a.jsx("div",{className:"mt-1 line-clamp-2 text-xs text-gray-500",children:s.details})]}),a.jsx("div",{className:`shrink-0 rounded px-2 py-1 text-xs font-medium ${s.type==="category"?"bg-purple-600/20 text-purple-300":"bg-blue-600/20 text-blue-300"}`,children:s.type==="category"?"Category":"Task"})]})})}const ne=y.forwardRef(({onSelectResult:e,placeholder:t="Search...",className:r=""},s)=>{const[n,o]=y.useState(""),[c,l]=y.useState(!1),i=y.useRef(null),{data:u=[]}=pt(),{data:d=[]}=Ee(),g=n.trim()?nr(n,u,d):[],h=f=>{o(""),l(!1),e(f)};return y.useEffect(()=>{const f=p=>{i.current&&!i.current.contains(p.target)&&l(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),y.useEffect(()=>{const f=p=>{p.key==="Escape"&&c&&(l(!1),o(""))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[c]),a.jsxs("div",{ref:i,className:`relative ${r}`,children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{ref:s,type:"text",value:n,onChange:f=>{o(f.target.value),l(!0)},onFocus:()=>n&&l(!0),placeholder:t,className:"w-full rounded-lg border border-gray-700/50 bg-gray-800/60 px-4 py-2 pr-10 text-sm text-gray-100 placeholder-gray-500 transition-colors focus:border-blue-500/50 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600/50 dark:bg-gray-700/60"}),a.jsx("svg",{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n&&a.jsx("button",{onClick:()=>{o(""),l(!1)},className:"absolute right-10 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300",children:a.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]}),a.jsx(or,{results:g,onSelectResult:h,isVisible:c&&n.trim().length>0})]})});ne.displayName="GlobalSearchBar";function ir({activeTab:e,variant:t="desktop",onTaskSelect:r}){const s=Ue(),n=y.useRef(null),[o,c]=y.useState(!1);y.useEffect(()=>{const i=u=>{(u.ctrlKey||u.metaKey)&&u.key==="k"&&(u.preventDefault(),t==="mobile"?(c(!0),setTimeout(()=>n.current?.focus(),0)):n.current?.focus())};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[t]);const l=i=>{i.node.type==="task"?r?.(i.node.id):i.node.type==="category"&&s(`/org-chart/${i.categoryId}`),t==="mobile"&&c(!1)};return t==="mobile"?a.jsx("div",{className:"border-b border-gray-700/30 bg-gray-900/90 shadow-sm backdrop-blur-sm dark:border-gray-600/30 dark:bg-gray-800/90",children:a.jsx("div",{className:"mx-auto px-4 py-2",children:a.jsx("div",{className:"flex items-center gap-3",children:o?a.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[a.jsx(ne,{ref:n,onSelectResult:l,placeholder:"Search categories & tasks... (Ctrl+K)",className:"flex-1"}),a.jsx("button",{onClick:()=>c(!1),className:"shrink-0 rounded-lg p-2 text-gray-400 hover:text-gray-200","aria-label":"Close search",children:a.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}):a.jsxs("button",{onClick:()=>c(!0),className:"flex w-full items-center gap-2 rounded-lg border border-gray-700/50 bg-gray-800/60 px-4 py-2 text-sm text-gray-400 transition-colors hover:border-gray-600/50 hover:text-gray-300","aria-label":"Open search",children:[a.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),a.jsx("span",{children:"Search categories & tasks..."})]})})})}):a.jsx("div",{className:"border-b border-gray-700/30 bg-gray-900/90 shadow-sm backdrop-blur-sm dark:border-gray-600/30 dark:bg-gray-800/90",children:a.jsx("div",{className:"mx-auto max-w-[1800px] px-6 py-2",children:a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Ve,{activeTab:e,variant:t})}),a.jsx("div",{className:"w-80",children:a.jsx(ne,{ref:n,onSelectResult:l,placeholder:"Search... (Ctrl+K)"})})]})})})}const ar=new qe;function cr(){const{categoryId:e}=Qe(),t=ke(),[r,s]=y.useState(!1),[n,o]=y.useState(!1),[c,l]=y.useState(void 0),[i,u]=y.useState(!1),[d,g]=y.useState(!1),{data:h,isLoading:f}=Ee(),p=M=>{l(M.id),o(!0)},x=M=>{l(M),o(!0)},{data:C,isLoading:w,error:b}=Q({queryKey:O.orgTree(e||""),queryFn:()=>je(e||""),placeholderData:Ce,enabled:!!e&&!f});if(f)return a.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-950",children:a.jsx("div",{className:"text-gray-400",children:"Loading categories..."})});const A=h?.find(M=>M.id===e);if(!e||!A)return a.jsx(ze,{to:"/org-chart",replace:!0});const k=A.name;return a.jsxs("div",{className:"app-layout",children:[a.jsx("nav",{className:"nav bg-gray-900 dark:bg-gray-800",children:t?a.jsx(Je,{onOpenTasksDueToday:()=>s(!0),onOpenTimeReport:()=>u(!0),onOpenQuickAdd:()=>o(!0),onOpenHamburger:()=>g(!0),onTaskSelect:x}):a.jsx(Xe,{onOpenTasksDueToday:()=>s(!0),onOpenQuickAdd:()=>o(!0),onOpenHamburger:()=>g(!0),onRecentTaskClick:p,onTaskSelect:x})}),a.jsx(ir,{activeTab:e,variant:t?"mobile":"desktop",onTaskSelect:x}),a.jsxs("main",{className:"main p-4",children:[w&&a.jsxs("div",{className:"text-gray-900 dark:text-gray-100",children:["Loading ",k," tree..."]}),b&&a.jsxs("div",{className:"text-red-600 dark:text-red-400",children:["Error loading ",k," tree:"," ",b instanceof Error?b.message:"Unknown error"]}),C&&a.jsx(gt,{categoryId:e})]}),r&&a.jsx(Ze,{isOpen:r,onClose:()=>s(!1)}),n&&a.jsx(et,{isOpen:n,onClose:()=>{o(!1),l(void 0)},initialTaskId:c}),i&&a.jsx(tt,{isOpen:i,onClose:()=>u(!1)}),d&&a.jsx(rt,{isOpen:d,onClose:()=>g(!1),activeTab:e})]})}const wr=Ke(function(){return a.jsx(st,{children:a.jsx(We,{client:ar,children:a.jsx(cr,{})})})});export{wr as default};
