import{w as y,p as e,v as g,a as c,t as l}from"./chunk-PVWAREVJ-BCzKU303.js";import{u as h}from"./supabaseClient-BnqcRS6D.js";import{u as j,Q as N,a as b}from"./QueryClientProvider-C6_AEzee.js";import{u as p,a as v}from"./journal-DNiKXfIH.js";import{u as f,Q as o}from"./queryKeys-DYvrcQe-.js";function E(){const s=j();return f({mutationFn:async r=>{console.log("üöÄ EDIT JOURNAL MUTATION: Starting",r);const a=await p(r.id,r);return console.log("‚úÖ EDIT JOURNAL MUTATION: Server returned",a),a},onMutate:async r=>{await s.cancelQueries({queryKey:o.journalEntry(String(r.id))});const a=s.getQueryData(o.journalEntry(String(r.id)));if(console.log("üîÑ EDIT JOURNAL ONMUTATE: Previous entry:",a),a){const i={...a,...r,updated_at:new Date().toISOString()};s.setQueryData(o.journalEntry(String(r.id)),i),console.log("üîÑ EDIT JOURNAL ONMUTATE: Optimistically updated cache",i)}return{previousEntry:a}},onError:(r,a,i)=>{console.error("‚ùå EDIT JOURNAL ONERROR:",r),i?.previousEntry&&s.setQueryData(o.journalEntry(String(a.id)),i.previousEntry)},onSettled:(r,a,i)=>{console.log("üîÑ EDIT JOURNAL ONSETTLED: Refetching entry",i?.id),s.invalidateQueries({queryKey:o.journalEntry(String(i?.id))})}})}const k=new N,U=y(function(){return e.jsx(b,{client:k,children:e.jsx(w,{})})});function w(){const{entryId:s}=g(),{data:t,isLoading:r,error:a}=h({queryKey:["journalEntry",s],queryFn:()=>v(Number(s)),enabled:!!s&&!isNaN(Number(s))}),[i,u]=c.useState(""),x=E();c.useEffect(()=>{t&&u(t.editorial_text??"")},[t]),c.useEffect(()=>{if(!t)return;const n=setTimeout(()=>{i!==(t.editorial_text??"")&&x.mutate({id:t.id,editorial_text:i})},1e4);return()=>clearTimeout(n)},[i,t,x]);const m=n=>new Date(n).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),d=n=>new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"});return!s||isNaN(Number(s))?e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Invalid Entry ID"}),e.jsx(l,{to:"/journal",className:"text-blue-600 hover:underline",children:"‚Üê Back to Journal"})]})}):e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900",children:[e.jsxs("nav",{className:"bg-gray-900 dark:bg-gray-800 px-4 py-3 space-x-4",children:[e.jsx(l,{to:"/",className:"text-gray-300 hover:text-white transition-colors",children:"Home"}),e.jsx(l,{to:"/journal",className:"text-gray-300 hover:text-white transition-colors",children:"Journal"})]}),e.jsxs("main",{className:"p-8 max-w-4xl mx-auto",children:[r&&e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Loading entry..."})}),a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"text-red-600 dark:text-red-400 mb-4",children:["Error loading journal entry: ",a.message]}),e.jsx(l,{to:"/journal",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"‚Üê Back to Journal"})]}),t===null&&!r&&!a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Journal entry not found"}),e.jsx(l,{to:"/journal",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"‚Üê Back to Journal"})]}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:m(t.entry_date)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 text-right",children:[e.jsxs("div",{children:["Entry #",t.id]}),e.jsxs("div",{children:["Created: ",d(t.created_at)]}),t.updated_at!==t.created_at&&e.jsxs("div",{children:["Updated: ",d(t.updated_at)]})]})]})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Journal Entry"}),e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Details:"}),e.jsx("textarea",{className:"w-full  p-2 border rounded mb-4",rows:4,value:i,onChange:n=>u(n.target.value)})]}),t.tasks&&t.tasks.length>0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Task Activity"}),e.jsx("div",{className:"space-y-3",children:t.tasks.map(n=>e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-gray-700 rounded p-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n.action==="completed"?"bg-green-500":n.action==="created"?"bg-blue-500":"bg-yellow-500"}`}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 capitalize",children:n.action}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["task #",n.org_node_id]})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:d(n.created_at)})]},n.id))})]}),e.jsxs("div",{className:"flex space-x-4 pt-6",children:[e.jsx(l,{to:"/journal",className:"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"‚Üê Back to Journal"}),e.jsx(l,{to:`/journal/edit/${t.id}`,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Edit Entry"})]})]})]})]})}export{U as default};
