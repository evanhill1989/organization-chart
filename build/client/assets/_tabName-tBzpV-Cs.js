import{a as x,p as e,w as xe,v as he,x as ge,t as V}from"./chunk-PVWAREVJ-BCzKU303.js";import{u as P,Q as pe,a as fe,k as ye}from"./QueryClientProvider-CDBXVrxO.js";import{s as $,u as be}from"./supabaseClient-D0Nl3FeP.js";import{g as S,M as ve}from"./index-EJzAW6rU.js";import{u as B}from"./useMutation-DColmKXA.js";/*!
 * @gsap/react 2.1.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let G=typeof document<"u"?x.useLayoutEffect:x.useEffect,X=t=>t&&!Array.isArray(t)&&typeof t=="object",R=[],je={},te=S;const F=(t,s=R)=>{let n=je;X(t)?(n=t,t=null,s="dependencies"in n?n.dependencies:R):X(s)&&(n=s,s="dependencies"in n?n.dependencies:R),t&&typeof t!="function"&&console.warn("First parameter must be a function or config object");const{scope:r,revertOnUpdate:a}=n,u=x.useRef(!1),d=x.useRef(te.context(()=>{},r)),i=x.useRef(g=>d.current.add(null,g)),c=s&&s.length&&!a;return c&&G(()=>(u.current=!0,()=>d.current.revert()),R),G(()=>{if(t&&d.current.add(t,r),!c||!u.current)return()=>d.current.revert()},s),{context:d.current,contextSafe:i.current}};F.register=t=>{te=t};F.headless=!0;function W({onAdd:t,onClose:s}){const[n,r]=x.useState(""),[a,u]=x.useState("task"),[d,i]=x.useState(""),[c,g]=x.useState(1),[o,h]=x.useState(""),[m,j]=x.useState(1),[y,b]=x.useState(1),w=l=>l?new Date(l).toISOString().split("T")[0]:"";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("form",{className:"bg-gray-800 rounded-lg shadow-lg min-w-[320px] max-w-[400px] p-6 flex flex-col items-center relative max-h-[90vh] overflow-y-auto",onSubmit:l=>{l.preventDefault(),n.trim()&&(t({name:n.trim(),type:a,details:d.trim()||void 0,importance:a==="task"?c:void 0,deadline:a==="task"&&o?o:void 0,completion_time:a==="task"&&m?Number(m):void 0,unique_days_required:a==="task"&&y?Number(y):void 0}),r(""),i(""),g(1),h(""),j(1),b(1),s())},children:[e.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-400 hover:text-white text-2xl font-bold",onClick:s,"aria-label":"Close",children:"×"}),e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Add New Node"}),e.jsx("input",{className:"mb-2 px-2 py-1 rounded w-full text-black",type:"text",placeholder:"Name",value:n,onChange:l=>r(l.target.value),required:!0}),e.jsxs("select",{className:"mb-2 px-2 py-1 rounded w-full",value:a,onChange:l=>u(l.target.value),children:[e.jsx("option",{value:"category",children:"Category"}),e.jsx("option",{value:"task",children:"Task"})]}),e.jsx("input",{className:"mb-2 px-2 py-1 rounded w-full text-black",type:"text",placeholder:"Details (optional)",value:d,onChange:l=>i(l.target.value)}),a==="task"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full mb-2",children:[e.jsx("label",{className:"block text-white text-sm font-medium mb-1",children:"Importance (1-10):"}),e.jsx("select",{className:"px-2 py-1 rounded w-full text-black",value:c,onChange:l=>g(Number(l.target.value)),children:Array.from({length:10},(l,N)=>N+1).map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{className:"w-full mb-2",children:[e.jsx("label",{className:"block text-white text-sm font-medium mb-1",children:"Deadline:"}),e.jsx("input",{className:"px-2 py-1 rounded w-full text-black",type:"date",value:w(o),onChange:l=>h(l.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"w-full mb-2",children:[e.jsx("label",{className:"block text-white text-sm font-medium mb-1",children:"Estimated Completion Time (hours):"}),e.jsx("input",{className:"px-2 py-1 rounded w-full text-black",type:"number",min:"0.5",step:"0.5",value:m,onChange:l=>j(l.target.value===""?"":Number(l.target.value)),placeholder:"e.g. 8.5"})]}),e.jsxs("div",{className:"w-full mb-2",children:[e.jsx("label",{className:"block text-white text-sm font-medium mb-1",children:"Unique Days Required:"}),e.jsx("input",{className:"px-2 py-1 rounded w-full text-black",type:"number",min:"0.5",step:"0.5",value:y,onChange:l=>b(l.target.value===""?"":Number(l.target.value)),placeholder:"e.g. 3"}),e.jsx("p",{className:"text-xs text-gray-300 mt-1",children:"Number of separate days needed to complete this task"})]})]}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-1 rounded font-semibold hover:bg-blue-700 mt-2",type:"submit",children:"Add"})]})})}function re(t){const s=new Map,n={};return t.forEach(r=>{s.set(r.id,{id:r.id,name:r.name,type:r.type,details:r.details??void 0,importance:r.importance??(r.type==="task"?1:void 0),deadline:r.deadline??void 0,completion_time:r.completion_time??void 0,unique_days_required:r.unique_days_required??void 0,children:[],tab_name:r.tab_name,root_category:r.root_category})}),t.forEach(r=>{const a=s.get(r.id);if(r.parent_id){const u=s.get(r.parent_id);u&&u.children.push(a)}else n[r.root_category??"default"]=a}),n}async function we({name:t,type:s,details:n,importance:r,deadline:a,completion_time:u,unique_days_required:d,parent_id:i,tab_name:c,root_category:g}){const{data:o,error:h}=await $.from("org_nodes").insert([{name:t,type:s,details:n,importance:s==="task"?r??1:void 0,deadline:s==="task"?a:void 0,completion_time:s==="task"?u:void 0,unique_days_required:s==="task"?d:void 0,parent_id:i,tab_name:c,root_category:g}]).select().single();if(console.log(o),h)throw h;const{data:m,error:j}=await $.from("org_nodes").select("*").eq("root_category",g);if(j)throw j;return re(m??[])[g]??{id:0,name:g,type:"category",root_category:g,children:[]}}function z(t){const s=P();return B({mutationFn:async r=>await we(r),onMutate:async r=>{await s.cancelQueries({queryKey:["orgTree",t]});const a=s.getQueryData(["orgTree",t]);if(!a)return{previousTree:null};const u={id:Date.now(),name:r.name,type:r.type,tab_name:r.tab_name,root_category:r.root_category,details:r.details,importance:r.type==="task"?r.importance??1:void 0,deadline:r.type==="task"?r.deadline:void 0,completion_time:r.type==="task"?r.completion_time:void 0,unique_days_required:r.type==="task"?r.unique_days_required:void 0,children:[]};function d(c,g,o){return c.id===g?{...c,children:[...c.children??[],o]}:c.children&&c.children.length>0?{...c,children:c.children.map(h=>d(h,g,o))}:c}let i;return r.parent_id?i=d(a,r.parent_id,u):i={...a,children:[...a.children??[],u]},s.setQueryData(["orgTree",t],i),{previousTree:a}},onSuccess:r=>{s.setQueryData(["orgTree",t],r)},onError:(r,a,u)=>{console.error(r),u?.previousTree&&s.setQueryData(["orgTree",t],u.previousTree)},onSettled:()=>{s.invalidateQueries({queryKey:["orgTree",t]})}})}function H(t,s,n){if(!t||!s||!n)return 1;const r=new Date,u=new Date(t).getTime()-r.getTime(),d=Math.ceil(u/(1e3*3600*24));if(d<=0||n>=d)return 10;try{const i=n/d*(s/d)+Math.exp(4*(n/d)/(1-n/d))-1;return i<.25?1:i>=.25&&i<.5?2:i>=.5&&i<1?3:i>=1&&i<1.75?4:i>=1.75&&i<2.5?5:i>=2.5&&i<4?6:i>=4&&i<5.5?7:i>=5.5&&i<7.5?8:i>=7.5&&i<10?9:10}catch(i){return console.warn("Urgency calculation failed:",i),1}}function Ne(t){return t.type!=="task"?1:H(t.deadline,t.completion_time,t.unique_days_required)}function Te(t=1){switch(t){case 1:return"";case 2:return"bg-lime-400";case 3:return"bg-yellow-400";case 4:return"bg-yellow-500";case 5:return"bg-amber-500";case 6:return"bg-orange-400";case 7:return"bg-orange-500";case 8:return"bg-red-400";case 9:return"bg-red-500";case 10:return"bg-red-600";default:return""}}function ke(t=1){if(t<=1)return"";switch(t){case 2:case 3:return"w-2 h-2";case 4:case 5:case 6:return"w-3 h-3";case 7:case 8:return"w-4 h-4";case 9:case 10:return"w-5 h-5";default:return"w-2 h-2"}}function Ce(t=1){if(t<=1)return 0;switch(t){case 2:return 4;case 3:return 3.5;case 4:return 3;case 5:return 2.5;case 6:return 2;case 7:return 1.5;case 8:return 1.2;case 9:return 1;case 10:return .8;default:return 2}}function _e(t=1){if(t<=1)return"";switch(t){case 2:return"shadow-sm shadow-lime-400/50";case 3:return"shadow-sm shadow-yellow-400/50";case 4:return"shadow-sm shadow-yellow-500/50";case 5:return"shadow-md shadow-amber-500/50";case 6:return"shadow-md shadow-orange-400/50";case 7:return"shadow-md shadow-orange-500/50";case 8:return"shadow-lg shadow-red-400/60";case 9:return"shadow-lg shadow-red-500/70";case 10:return"shadow-xl shadow-red-600/80";default:return""}}function se(t=1){return t>1}function De(t){const s=t.getBoundingClientRect(),n=s.width,r=s.height,a=window.getComputedStyle(t),u=parseFloat(a.borderRadius)||8,d=Math.min(n,r)/2,i=Math.min(u,d),c=[],g=0,o=n,h=0,m=r;return c.push(`M ${n/2} ${h}`),c.push(`L ${o-i} ${h}`),c.push(`Q ${o} ${h} ${o} ${h+i}`),c.push(`L ${o} ${m-i}`),c.push(`Q ${o} ${m} ${o-i} ${m}`),c.push(`L ${g+i} ${m}`),c.push(`Q ${g} ${m} ${g} ${m-i}`),c.push(`L ${g} ${h+i}`),c.push(`Q ${g} ${h} ${g+i} ${h}`),c.push(`L ${n/2} ${h}`),c.join(" ")}function Se(t=1){return{duration:Ce(t),ease:"none",repeat:-1,autoRotate:t>=7,yoyo:!1}}function ae(t){if(t.type==="task")return Ne(t);if(!t.children||t.children.length===0)return 1;const s=t.children.map(n=>ae(n));return Math.max(...s)}function ne(t){return ae(t)}function Ee(t=1){switch(t){case 1:return"";case 2:return"border-2 border-cyan-400";case 3:return"border-2 border-cyan-500";case 4:return"border-2 border-blue-400";case 5:return"border-2 border-blue-500";case 6:return"border-2 border-indigo-400";case 7:return"border-2 border-indigo-500";case 8:return"border-2 border-purple-400";case 9:return"border-2 border-purple-500";case 10:return"border-2 border-purple-600";default:return""}}function Me(t=1){if(t<=1)return"";switch(t){case 2:return"shadow-lg shadow-cyan-400/50";case 3:return"shadow-lg shadow-cyan-500/50";case 4:return"shadow-lg shadow-blue-400/50";case 5:return"shadow-lg shadow-blue-500/50";case 6:return"shadow-lg shadow-indigo-400/50";case 7:return"shadow-lg shadow-indigo-500/50";case 8:return"shadow-lg shadow-purple-400/50";case 9:return"shadow-lg shadow-purple-500/50";case 10:return"shadow-xl shadow-purple-600/75";default:return""}}function oe(t){if(t.type==="task")return t.importance??1;if(!t.children||t.children.length===0)return 1;const s=t.children.map(n=>oe(n));return Math.max(...s)}function K(t){return oe(t)}function qe(t){return!t||t<=1?"rgba(0, 0, 0, 0)":t<=3?"rgba(6, 182, 212, 0.6)":t<=5?"rgba(59, 130, 246, 0.6)":t<=7?"rgba(99, 102, 241, 0.6)":t<=9?"rgba(147, 51, 234, 0.6)":"rgba(126, 34, 206, 0.8)"}function le({node:t,level:s=0,onTaskClick:n,openMap:r,toggleOpen:a,path:u}){const d=t.type==="task",i=r[u]||!1,c=z(t.root_category),[g,o]=x.useState(!1),h=ne(t),m=K(t),j=y=>{const b={...y,parent_id:t.id,tab_name:t.tab_name??"",root_category:t.root_category};c.mutate(b)};return e.jsxs("div",{className:`flex flex-col items-center w-full ${s===0?"":"mt-4"}`,children:[e.jsxs("div",{"data-node-path":u,"data-urgency":h,className:`bg-white rounded-lg shadow-amber-600 min-w-[120px] text-center outline outline-gray-400 relative ${t.is_completed?"opacity-60 bg-green-50":""} ${Ee(m)} ${Me(m)}`,children:[!t.is_completed&&se(h)&&e.jsx("div",{className:`absolute rounded-full pointer-events-none z-10 ${Te(h)} ${ke(h)} ${_e(h)}`,"data-urgency-ball":u,style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}),d?e.jsxs("button",{className:`text-lg font-semibold underline hover:text-blue-200 focus:outline-none w-full h-full p-2 rounded-lg ${t.is_completed?"bg-green-600 text-white line-through":"bg-blue-600 text-white"}`,onClick:()=>n(t),children:[t.name,t.is_completed&&e.jsx("span",{className:"ml-2 text-xs",children:"✓"})]}):e.jsx("button",{className:"text-lg text-white font-semibold w-full text-center focus:outline-none bg-gray-800 p-2 rounded-lg",onClick:()=>a(u),type:"button",children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[t.name,e.jsx("span",{className:"ml-1 text-gray-400",children:i?"▼":"▶"})]})})]}),!d&&i&&e.jsxs("div",{className:"grid gap-4 mt-4 w-full auto-cols-min grid-flow-col",children:[t.children?.map(y=>e.jsx(le,{node:y,level:s+1,onTaskClick:n,openMap:r,toggleOpen:a,path:`${u}/${y.name}`},y.name)),e.jsx("button",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl font-bold hover:bg-blue-700",onClick:()=>o(!0),title:"Add Node",type:"button",children:"+"})]}),g&&e.jsx(W,{parent_id:t.id,tab_name:t.tab_name??"",onAdd:j,onClose:()=>o(!1)})]})}async function Ae({id:t,name:s,details:n,importance:r,deadline:a,completion_time:u,unique_days_required:d,is_completed:i,completed_at:c,completion_comment:g}){const o={};s!==void 0&&(o.name=s),n!==void 0&&(o.details=n),r!==void 0&&(o.importance=r),a!==void 0&&(o.deadline=a),u!==void 0&&(o.completion_time=u),d!==void 0&&(o.unique_days_required=d),i!==void 0&&(o.is_completed=i),c!==void 0&&(o.completed_at=c??void 0),g!==void 0&&(o.completion_comment=g);const{data:h,error:m}=await $.from("org_nodes").update(o).eq("id",t).select().single();if(m)throw m;return h}function $e(t){const s=P();return B({mutationFn:async r=>{console.log("🚀 EDIT MUTATION: Starting edit of node:",r.id,r);const a=await Ae(r);return console.log("✅ EDIT MUTATION: Server returned updated row"),a},onMutate:async r=>{console.log("🔄 EDIT ONMUTATE: Starting optimistic edit for node:",r.id),console.log("🔄 EDIT ONMUTATE: Edit data:",r),console.log("🔄 EDIT ONMUTATE: Root category:",t),await s.cancelQueries({queryKey:["orgTree",t]}),console.log("🔄 EDIT ONMUTATE: Cancelled queries for:",["orgTree",t]);const a=s.getQueryData(["orgTree",t]);if(console.log("🔄 EDIT ONMUTATE: Previous tree:",JSON.stringify(a,null,2)),!a||!r.id)return console.log("❌ EDIT ONMUTATE: No previous tree or node ID found, aborting optimistic update"),{previousTree:null};function u(c,g,o){if(console.log(`🔍 EDIT ONMUTATE: Checking node ${c.id} (${c.name}) for update`),c.id===g){console.log("✅ EDIT ONMUTATE: Found target node for update:",c.name);const h={...c,...o.name!==void 0&&{name:o.name},...o.details!==void 0&&{details:o.details},...o.importance!==void 0&&{importance:o.importance},...o.deadline!==void 0&&{deadline:o.deadline},...o.completion_time!==void 0&&{completion_time:o.completion_time},...o.unique_days_required!==void 0&&{unique_days_required:o.unique_days_required},...o.is_completed!==void 0&&{is_completed:o.is_completed},...o.completed_at!==void 0&&{completed_at:o.completed_at===null?void 0:o.completed_at},...o.completion_comment!==void 0&&{completion_comment:o.completion_comment}};return console.log("🔄 EDIT ONMUTATE: Updated node:",h),h}if(c.children&&c.children.length>0){console.log(`🔍 EDIT ONMUTATE: Searching ${c.children.length} children of ${c.name}`);const h=c.children.map(m=>u(m,g,o));return{...c,children:h}}return console.log(`🔍 EDIT ONMUTATE: No children in ${c.name}, returning unchanged`),c}const d=u(a,r.id,{name:r.name,details:r.details,importance:r.importance,deadline:r.deadline,completion_time:r.completion_time,unique_days_required:r.unique_days_required,is_completed:r.is_completed,completed_at:r.completed_at,completion_comment:r.completion_comment});console.log("🔄 EDIT ONMUTATE: New tree structure:",JSON.stringify(d,null,2)),s.setQueryData(["orgTree",t],d),console.log("🔄 EDIT ONMUTATE: Set query data for:",["orgTree",t]);const i=s.getQueryData(["orgTree",t]);return console.log("🔄 EDIT ONMUTATE: Verified cached data:",JSON.stringify(i,null,2)),{previousTree:a}},onSuccess:r=>{console.log("✅ EDIT ONSUCCESS: Node successfully updated on server"),console.log("✅ EDIT ONSUCCESS: Updated row:",r)},onError:(r,a,u)=>{console.log("❌ EDIT ONERROR: Edit failed for node:",a.id,"Error:",r),console.log("❌ EDIT ONERROR: Rolling back to previous tree:",u?.previousTree),u?.previousTree&&s.setQueryData(["orgTree",t],u.previousTree)},onSettled:()=>{console.log("🔄 EDIT ONSETTLED: Invalidating queries for:",["orgTree",t]),s.invalidateQueries({queryKey:["orgTree",t]})}})}async function Oe(t){const{error:s}=await $.from("org_nodes").delete().eq("id",t);if(s)throw s}function Le(t){const s=P();return B({mutationFn:async r=>await Oe(r),onMutate:async r=>{await s.cancelQueries({queryKey:["orgTree",t]});const a=s.getQueryData(["orgTree",t]);if(!a)return{previousTree:null};function u(i,c){if(i.id===c)return null;if(i.children&&i.children.length>0){const g=i.children.map(o=>u(o,c)).filter(o=>o!==null);return g.length!==i.children.length?{...i,children:g}:{...i,children:g}}return i}const d=u(a,r);return d?(s.setQueryData(["orgTree",t],d),{previousTree:a}):{previousTree:a}},onSuccess:()=>{},onError:(r,a,u)=>{console.error(r),console.log(a),u?.previousTree&&s.setQueryData(["orgTree",t],u.previousTree)},onSettled:()=>{s.invalidateQueries({queryKey:["orgTree",t]})}})}function J({task:t,onClose:s}){const[n,r]=x.useState(""),[a,u]=x.useState(1),[d,i]=x.useState(""),[c,g]=x.useState(1),[o,h]=x.useState(1),[m,j]=x.useState(!1),[y,b]=x.useState(""),[w,l]=x.useState(null),N=$e(t?.root_category||""),M=Le(t?.root_category||""),T=x.useRef(null),O=v=>v?new Date(v).toISOString().split("T")[0]:"",k=t?.type==="task"?H(d,c,o):1;if(F(()=>{t?.type==="task"&&(k===10||a===10)&&!m?S.to(T.current,{scale:1.02,duration:1,ease:"power2.inOut",yoyo:!0,repeat:-1}):(S.killTweensOf(T.current),S.set(T.current,{scale:1}))},[t,k,a,m]),x.useEffect(()=>{t&&(r(t.details??""),u(t.importance??1),i(t.deadline??""),g(t.completion_time??1),h(t.unique_days_required??1),j(t.is_completed??!1),b(t.completion_comment??""),l(t.completed_at??null))},[t]),x.useEffect(()=>{if(!t)return;const v=setTimeout(()=>{if(n!==(t.details??"")||a!==(t.importance??1)||d!==(t.deadline??"")||c!==(t.completion_time??1)||o!==(t.unique_days_required??1)||m!==(t.is_completed??!1)){const _={id:t.id,details:n,importance:t.type==="task"?a:void 0,deadline:t.type==="task"?d:void 0,completion_time:t.type==="task"?c:void 0,unique_days_required:t.type==="task"?o:void 0,is_completed:t.type==="task"?m:void 0};t.type==="task"&&m&&!t.is_completed?(_.completed_at=new Date().toISOString(),_.completion_comment=y):t.type==="task"&&!m&&t.is_completed&&(_.completed_at=void 0,_.completion_comment=void 0),N.mutate(_)}},1e3);return()=>clearTimeout(v)},[n,a,d,c,o,m,t,N,y]),x.useEffect(()=>{if(!t||!m)return;const v=setTimeout(()=>{y!==(t.completion_comment??"")&&N.mutate({id:t.id,completion_comment:y})},2e3);return()=>clearTimeout(v)},[y,t,N,m]),!t)return null;const E=()=>{M.mutate(t.id),s()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-start justify-center z-50 pt-20",children:e.jsxs("div",{ref:T,className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full relative max-h-[calc(90vh-5rem)] overflow-y-auto",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl font-bold",onClick:s,"aria-label":"Close",children:"×"}),e.jsx("h3",{className:"text-2xl font-bold mb-4",children:t.name}),t.type==="task"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`mb-6 p-4 rounded-lg border ${m?"bg-green-50 border-green-300":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"font-semibold text-gray-700 flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:v=>j(v.target.checked),className:"mr-2 w-5 h-5 text-green-600 rounded focus:ring-green-500 cursor-pointer"}),e.jsx("span",{className:m?"text-green-700":"",children:m?"Task Completed":"Mark as Completed"})]}),w&&e.jsx("span",{className:"text-sm text-gray-500",children:new Date(w).toLocaleDateString()})]}),m&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Completion Notes (optional):"}),e.jsx("textarea",{className:"w-full text-sm text-black p-2 border rounded focus:ring-2 focus:ring-green-500 focus:border-green-500",rows:3,placeholder:"Add any notes about completing this task...",value:y,onChange:v=>b(v.target.value)}),w&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Completed on ",new Date(w).toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Importance (1-10):"}),e.jsx("select",{className:"w-full text-black p-2 border rounded",value:a,onChange:v=>{const p=Number(v.target.value);u(p)},disabled:m,children:Array.from({length:10},(v,p)=>p+1).map(v=>e.jsx("option",{value:v,children:v},v))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Deadline:"}),e.jsx("input",{className:"w-full text-black p-2 border rounded",type:"date",value:O(d),onChange:v=>i(v.target.value),disabled:m})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Estimated Completion Time (hours):"}),e.jsx("input",{className:"w-full text-black p-2 border rounded",type:"number",min:"0.5",step:"0.5",value:c,onChange:v=>{const p=Number(v.target.value);g(p)},disabled:m})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Unique Days Required:"}),e.jsx("input",{className:"w-full text-black p-2 border rounded",type:"number",min:"0.5",step:"0.5",value:o,onChange:v=>{const p=Number(v.target.value);h(p)},disabled:m}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Number of separate days needed to complete this task"})]}),!m&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-100 rounded",children:[e.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"Calculated Urgency Level:"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["Level ",k]}),d&&c&&o&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Based on deadline, completion time, and unique days required"})]})]}),e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Details:"}),e.jsx("textarea",{className:"w-full text-black p-2 border rounded mb-4",rows:4,value:n,onChange:v=>r(v.target.value),disabled:t.type==="task"&&m}),!m&&e.jsxs("button",{className:"mt-6 bg-red-600 text-white px-4 py-2 rounded font-semibold hover:bg-red-700",onClick:E,children:["Delete ",t.type==="task"?"Task":"Category"]})]})})}S.registerPlugin(ve);function ie(t,s,n){const r=n?`${n}/${t.name}`:`/${t.name}`;if(K(t)!==10)return null;if(t.type==="task"||!s[r])return r;if(t.children)for(const d of t.children){const i=ie(d,s,r);if(i)return i}return null}function de(t,s,n){const r=n?`${n}/${t.name}`:`/${t.name}`;if(ne(t)<=1)return[];if(t.type==="task")return[r];if(!s[r])return[r];const d=[];if(t.children)for(const i of t.children){const c=de(i,s,r);d.push(...c)}return d}function Ue({tree:t,tabName:s}){const[n,r]=x.useState(null),[a,u]=x.useState(!1),[d,i]=x.useState({[`/${s}`]:!0}),c=z(s),g=h=>{const m={...h,parent_id:t.id,tab_name:s,root_category:s};c.mutate(m)},o=h=>{i(m=>({...m,[h]:!m[h]}))};return F(()=>{S.killTweensOf("*"),S.set("*",{scale:1,boxShadow:"none"});const h=()=>{const j=new Set;if(t.children)for(const b of t.children)de(b,d,`/${s}`).forEach(l=>j.add(l));document.querySelectorAll("[data-urgency-ball]").forEach(b=>{const w=b.getAttribute("data-urgency-ball");if(!w)return;if(!j.has(w)){S.set(b,{opacity:0});return}S.set(b,{opacity:1});const l=document.querySelector(`[data-node-path="${w}"]`);if(!l)return;const N=parseInt(l.getAttribute("data-urgency")||"1");if(!se(N))return;const M=De(l),T=Se(N);S.set(b,{position:"absolute",left:0,top:0,xPercent:-50,yPercent:-50}),S.to(b,{motionPath:{path:M,autoRotate:T.autoRotate,alignOrigin:[.5,.5]},duration:T.duration,ease:T.ease,repeat:T.repeat})})},m=()=>{if(t.children)for(const j of t.children){const y=ie(j,d,`/${s}`);if(y){const b=`[data-node-path="${y}"]`,w=document.querySelector(b);if(w){const l=K(j),N=qe(l);S.set(w,{boxShadow:`0 0 20px ${N}`}),S.to(w,{scale:1.03,duration:1.2,ease:"power2.inOut",yoyo:!0,repeat:-1})}}}};S.delayedCall(.1,()=>{h(),m()})},[d,t,s]),e.jsxs("div",{className:"w-full max-w-4xl mx-auto p-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-center mb-8",children:s}),e.jsxs("div",{className:"grid gap-4 w-full auto-cols-min grid-flow-col",children:[t.children?.map(h=>e.jsx(le,{node:h,onTaskClick:r,openMap:d,toggleOpen:o,path:`/${s}/${h.name}`},h.name)),e.jsx("button",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl font-bold hover:bg-blue-700",onClick:()=>u(!0),title:"Add Node",type:"button",children:"+"})]}),a&&e.jsx(W,{parent_id:t.id,tab_name:s,onAdd:g,onClose:()=>u(!1)}),e.jsx(J,{task:n,onClose:()=>r(null)})]})}function Ie({isOpen:t,onClose:s}){const[n,r]=x.useState("add"),[a,u]=x.useState([]),[d,i]=x.useState([]),[c,g]=x.useState(!0),[o,h]=x.useState(null),[m,j]=x.useState(""),[y,b]=x.useState(!1),[w,l]=x.useState(""),[N,M]=x.useState(null),T=m?a.find(f=>f.id===m):null,O=z(T?.root_category||""),k=(f,D)=>{const q=[f.name];let U=f;for(;U.parent_id;){const A=D.find(C=>C.id===U.parent_id);if(A)q.unshift(A.name),U=A;else break}return q.join(" > ")},E=async()=>{try{g(!0),h(null);const{data:f,error:D}=await $.from("org_nodes").select("*").order("root_category, name");if(D)throw D;const q=f,U=q.filter(C=>C.type==="category").map(C=>({id:C.id,name:C.name,type:C.type,root_category:C.root_category,path:k(C,q)})),A=q.filter(C=>C.type==="task").map(C=>({id:C.id,name:C.name,type:C.type,root_category:C.root_category,path:k(C,q)}));u(U),i(A)}catch(f){console.error("Error fetching data:",f),h(f instanceof Error?f.message:"Failed to load data")}finally{g(!1)}},v=async f=>{try{const{data:D,error:q}=await $.from("org_nodes").select("*").eq("id",f).single();if(q)throw q;M(D)}catch(D){console.error("Error loading task:",D),h("Failed to load task data")}},p=f=>{r(f),j(""),l(""),b(!1),M(null)},_=f=>{j(f),b(!!f)},L=async f=>{l(f),f==="new"?(b(!1),M(null)):typeof f=="number"?await v(f):(M(null),b(!1))},Q=f=>{if(!T)return;const D={...f,parent_id:m,tab_name:T.root_category,root_category:T.root_category};O.mutate(D,{onSuccess:()=>{b(!1),j(""),E()}})},I=()=>{M(null),l(""),E()};return x.useEffect(()=>{t&&E()},[t]),t?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[60] overflow-y-auto",children:[e.jsx("div",{className:"min-h-screen px-4 py-6 flex items-start justify-center",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-600",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Quick Task Manager"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-gray-100 text-2xl font-bold","aria-label":"Close",children:"×"})]}),e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>p("add"),className:`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${n==="add"?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Add Task"}),e.jsx("button",{type:"button",onClick:()=>p("edit"),className:`flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors ${n==="edit"?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:"Edit Task"})]})}),c&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Loading..."})]}),o&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 text-red-700 dark:text-red-300 text-sm",children:o}),!c&&e.jsxs("div",{className:"p-6 space-y-4",children:[n==="add"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Add to Category *"}),e.jsxs("select",{value:m,onChange:f=>_(f.target.value?Number(f.target.value):""),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Select a category..."}),a.map(f=>e.jsx("option",{value:f.id,children:f.path},f.id))]})]}),!m&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Select a category above to add a new task"})]}),n==="edit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Task *"}),e.jsxs("select",{value:w,onChange:f=>{const D=f.target.value;L(D==="new"?"new":D===""?"":Number(D))},className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Choose an option..."}),e.jsx("option",{value:"new",children:"Create New Task"}),e.jsx("optgroup",{label:"Existing Tasks",children:d.map(f=>e.jsx("option",{value:f.id,children:f.path},f.id))})]})]}),w==="new"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Add to Category *"}),e.jsxs("select",{value:m,onChange:f=>_(f.target.value?Number(f.target.value):""),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Select a category..."}),a.map(f=>e.jsx("option",{value:f.id,children:f.path},f.id))]})]}),!w&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Select a task above to edit, or create a new one"})]})]})]})}),y&&T&&e.jsx(W,{parent_id:m,tab_name:T.root_category,onAdd:Q,onClose:()=>b(!1)}),N&&e.jsx(J,{task:N,onClose:I})]}):null}function Re(t,s){const n=new Date,r=t==="28-days"?new Date(n.getTime()+672*60*60*1e3):s?new Date(s):new Date(n.getTime()+672*60*60*1e3);return{startDate:n,endDate:r}}function Fe(t,s){if(s==="All levels")return!0;const n=t||1;return{1:a=>a===1,"2-4":a=>a>=2&&a<=4,"5-6":a=>a>=5&&a<=6,"7-9":a=>a>=7&&a<=9,10:a=>a===10,"All levels":()=>!0}[s](n)}function Qe(t,s){const n=s.getTime()-t.getTime();return Math.ceil(n/(1e3*60*60*24))/7*25}function Y(t){const s=new Date,r=new Date(t).getTime()-s.getTime();return Math.ceil(r/(1e3*60*60*24))}function Z(t){return t<=.5?"text-green-600":t<=.8?"text-yellow-600":t<=1?"text-orange-600":"text-red-600"}function Pe(t){return t<=.5?"Light load":t<=.8?"Moderate load":t<=1?"Heavy load":"Overloaded"}function Be(t){return t.toISOString().split("T")[0]}function ce(t){return t.map(s=>({...s,daysUntilDeadline:s.deadline?Y(s.deadline):0,isOverdue:s.deadline?Y(s.deadline)<0:!1})).sort((s,n)=>s.daysUntilDeadline-n.daysUntilDeadline)}function We(t,s,n){let r=0;const a=[],u=[];return t.forEach(d=>{if(!d.deadline||!d.completion_time)return;const i=new Date(d.deadline),c=new Date,g=Math.ceil((i.getTime()-c.getTime())/(1e3*60*60*24));if(i<=n)r+=d.completion_time,a.push(d);else{const h=d.completion_time/g*s;r+=h,u.push({task:d,partialTime:h,totalTime:d.completion_time})}}),{totalRequiredTime:r,tasksInWindow:a,tasksWithPartialTime:u}}function ze(t,s){const n=[...t,...s.map(a=>a.task)];return ce(n).map(a=>{const u=s.find(d=>d.task.id===a.id);return{...a,isPartialTime:!!u,partialRequiredTime:u?.partialTime,effectiveRequiredTime:u?u.partialTime:a.completion_time||0}})}function He({isOpen:t,onClose:s}){const[n,r]=x.useState([]),[a,u]=x.useState(!0),[d,i]=x.useState(null),[c,g]=x.useState(null),o=async()=>{try{u(!0),i(null);const{data:l,error:N}=await $.from("org_nodes").select("*").eq("type","task").not("deadline","is",null).not("is_completed","is",!0);if(N)throw N;const O=ce(l).map(k=>({...k,urgencyLevel:H(k.deadline,k.completion_time,k.unique_days_required)})).sort((k,E)=>k.isOverdue&&!E.isOverdue?-1:!k.isOverdue&&E.isOverdue?1:k.isOverdue&&E.isOverdue?E.daysUntilDeadline-k.daysUntilDeadline:k.daysUntilDeadline-E.daysUntilDeadline);r(O)}catch(l){console.error("Error fetching all tasks:",l),i(l instanceof Error?l.message:"Failed to load tasks")}finally{u(!1)}};x.useEffect(()=>{t&&o()},[t]);const h=()=>{g(null),o()};if(!t)return null;const m=()=>e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded border-l-4 border-red-500",children:[e.jsx("div",{className:"text-sm text-red-700",children:"Overdue Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-red-800",children:n.filter(l=>l.isOverdue).length})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded border-l-4 border-orange-500",children:[e.jsx("div",{className:"text-sm text-orange-700",children:"Due This Week"}),e.jsx("div",{className:"text-2xl font-bold text-orange-800",children:n.filter(l=>!l.isOverdue&&l.daysUntilDeadline<=7).length})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded border-l-4 border-yellow-500",children:[e.jsx("div",{className:"text-sm text-yellow-700",children:"Due This Month"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-800",children:n.filter(l=>!l.isOverdue&&l.daysUntilDeadline>7&&l.daysUntilDeadline<=30).length})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded border-l-4 border-gray-500",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Total Time Required"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-800",children:[n.reduce((l,N)=>l+(N.completion_time||0),0).toFixed(1),"h"]})]})]}),j=()=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["Task","Category","Deadline","Days Left","Time Required","Unique Days","Urgency","Importance"].map(l=>e.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-gray-700",children:l},l))})}),e.jsx("tbody",{children:n.map((l,N)=>e.jsxs("tr",{className:`${N%2===0?"bg-gray-50":"bg-white"} ${l.isOverdue?"bg-red-50":""} hover:bg-blue-50 cursor-pointer transition-colors`,onClick:()=>g(l),title:"Click to view/edit task details",children:[e.jsxs("td",{className:"px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-800 hover:text-blue-600",children:l.name}),l.details&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 max-w-xs truncate",title:l.details,children:l.details})]}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-600",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:l.root_category})}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-600",children:l.deadline?new Date(l.deadline).toLocaleDateString():"No deadline"}),e.jsx("td",{className:`px-3 py-2 text-sm font-medium ${l.isOverdue?"text-red-600":l.daysUntilDeadline<=7?"text-orange-600":l.daysUntilDeadline<=30?"text-yellow-600":"text-gray-600"}`,children:l.isOverdue?`${Math.abs(l.daysUntilDeadline)} overdue`:`${l.daysUntilDeadline} days`}),e.jsxs("td",{className:"px-3 py-2 text-sm text-gray-600",children:[l.completion_time?.toFixed(1)||0,"h"]}),e.jsx("td",{className:"px-3 py-2 text-sm text-gray-600",children:l.unique_days_required?.toFixed(1)||0}),e.jsx("td",{className:"px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${l.urgencyLevel<=3?"bg-green-400":l.urgencyLevel<=6?"bg-yellow-400":l.urgencyLevel<=8?"bg-orange-400":"bg-red-500"}`}),e.jsxs("span",{className:"text-xs font-medium",children:["Level ",l.urgencyLevel]})]})}),e.jsx("td",{className:"px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${(l.importance||1)<=3?"bg-gray-300":(l.importance||1)<=6?"bg-blue-400":(l.importance||1)<=8?"bg-purple-400":"bg-purple-600"}`}),e.jsxs("span",{className:"text-xs font-medium",children:["Level ",l.importance||1]})]})})]},l.id))})]})}),y=()=>e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 4h.01M9 12h.01M9 16h.01"})}),e.jsx("p",{className:"mt-2",children:"No tasks found with deadlines"})]}),b=()=>e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 text-gray-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{children:"Loading tasks..."})]})}),w=()=>e.jsxs("div",{className:"text-center py-8 text-red-600",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})}),e.jsxs("p",{className:"mt-2",children:["Error: ",d]}),e.jsx("button",{onClick:o,className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"})]});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 pt-20",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-6xl w-full mx-4 max-h-[calc(90vh-5rem)] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Complete Task List"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["All tasks sorted by deadline • Total: ",n.length," tasks"]})]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-800 text-2xl font-bold",children:"×"})]}),a&&e.jsx(b,{}),d&&e.jsx(w,{}),!a&&!d&&n.length===0&&e.jsx(y,{}),!a&&!d&&n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(m,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Task Details"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Click on any task to view or edit its details"}),e.jsx(j,{})]})]}),e.jsx(J,{task:c,onClose:h})]})})}function Ke(){const[t,s]=x.useState({totalRequiredTime:0,totalAvailableTime:0,taskCount:0,ratio:0,tasks:[]}),[n,r]=x.useState(!0),[a,u]=x.useState(null),[d,i]=x.useState(!1),[c,g]=x.useState(!1),[o,h]=x.useState("28-days"),[m,j]=x.useState(""),[y,b]=x.useState("All levels"),w=async()=>{try{r(!0),u(null);const{startDate:p,endDate:_}=Re(o,m),L=Math.ceil((_.getTime()-p.getTime())/(1e3*60*60*24)),{data:Q,error:I}=await $.from("org_nodes").select("*").eq("type","task").gte("deadline",p.toISOString().split("T")[0]).not("deadline","is",null).not("completion_time","is",null).not("is_completed","is",!0);if(I)throw I;const f=Q.filter(me=>Fe(me.importance,y)),{totalRequiredTime:D,tasksInWindow:q,tasksWithPartialTime:U}=We(f,L,_),A=Qe(p,_),C=A>0?D/A:0,ue=ze(q,U);s({totalRequiredTime:D,totalAvailableTime:A,taskCount:f.length,ratio:C,tasks:ue})}catch(p){console.error("Error fetching time report data:",p),u(p instanceof Error?p.message:"An error occurred")}finally{r(!1)}};if(x.useEffect(()=>{w()},[o,m,y]),n)return e.jsxs("div",{className:"flex items-center space-x-2 text-white text-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Loading..."})]});if(a)return e.jsxs("div",{className:"text-red-400 text-sm",children:["Error: ",a]});const l=()=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-300",children:"Time Window:"}),e.jsxs("select",{className:"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600",value:o,onChange:p=>h(p.target.value),children:[e.jsx("option",{value:"28-days",children:"Next 28 days"}),e.jsx("option",{value:"custom",children:"Custom date"})]}),o==="custom"&&e.jsx("input",{type:"date",className:"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 mt-1",value:m,onChange:p=>j(p.target.value),min:Be(new Date)})]}),N=()=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"text-xs text-gray-300",children:"Importance:"}),e.jsxs("select",{className:"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600",value:y,onChange:p=>b(p.target.value),children:[e.jsx("option",{value:"All levels",children:"All levels"}),e.jsx("option",{value:"1",children:"Level 1"}),e.jsx("option",{value:"2-4",children:"Levels 2-4"}),e.jsx("option",{value:"5-6",children:"Levels 5-6"}),e.jsx("option",{value:"7-9",children:"Levels 7-9"}),e.jsx("option",{value:"10",children:"Level 10"})]})]}),M=()=>e.jsxs("button",{onClick:()=>i(!0),className:"flex flex-col space-y-1 border-l border-gray-600 pl-4 hover:bg-gray-800 p-2 rounded transition-colors",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"Time Analysis:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:`font-bold ${Z(t.ratio)}`,children:[(t.ratio*100).toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["(",t.totalRequiredTime.toFixed(1),"h /"," ",t.totalAvailableTime.toFixed(1),"h)"]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[t.taskCount," tasks • ",Pe(t.ratio)]})]}),T=()=>e.jsx("button",{onClick:()=>g(!0),className:"text-gray-400 hover:text-white transition-colors",title:"View all tasks",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),O=()=>e.jsx("button",{onClick:w,className:"text-gray-400 hover:text-white transition-colors",title:"Refresh report",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),k=()=>{const p=[{label:"Total Required Time",value:`${t.totalRequiredTime.toFixed(1)}h`,color:"text-gray-800"},{label:"Available Time",value:`${t.totalAvailableTime.toFixed(1)}h`,color:"text-gray-800"},{label:"Utilization",value:`${(t.ratio*100).toFixed(1)}%`,color:Z(t.ratio).replace("text-","text-")},{label:"Task Count",value:`${t.taskCount}`,color:"text-gray-800"}];return e.jsx("div",{className:"grid grid-cols-4 gap-4 mb-6",children:p.map((_,L)=>e.jsxs("div",{className:"bg-gray-100 p-4 rounded",children:[e.jsx("div",{className:"text-sm text-gray-600",children:_.label}),e.jsx("div",{className:`text-2xl font-bold ${_.color}`,children:_.value})]},L))})},E=()=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["Task","Deadline","Days Left","Time Required","Effective Time","Importance","Category"].map(p=>e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:p},p))})}),e.jsx("tbody",{children:t.tasks.map((p,_)=>e.jsxs("tr",{className:_%2===0?"bg-gray-50":"bg-white",children:[e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-800",children:[p.name,p.isPartialTime&&e.jsx("span",{className:"ml-2 text-xs text-blue-600 font-medium",children:"(Partial)"})]}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600",children:p.deadline?new Date(p.deadline).toLocaleDateString():"No deadline"}),e.jsx("td",{className:`px-4 py-2 text-sm ${p.isOverdue?"text-red-600 font-bold":p.daysUntilDeadline<=7?"text-orange-600":"text-gray-600"}`,children:p.isOverdue?`${Math.abs(p.daysUntilDeadline)} overdue`:`${p.daysUntilDeadline} days`}),e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-600",children:[p.completion_time?.toFixed(1)||0,"h"]}),e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-600",children:[e.jsxs("span",{className:p.isPartialTime?"text-blue-600 font-medium":"",children:[p.effectiveRequiredTime?.toFixed(1)||p.completion_time?.toFixed(1)||0,"h"]}),p.isPartialTime&&e.jsxs("div",{className:"text-xs text-gray-500",children:["(",((p.partialRequiredTime||0)/(p.completion_time||1)*100).toFixed(1),"% of total)"]})]}),e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-600",children:["Level ",p.importance||1]}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600",children:p.root_category})]},p.id))})]})}),v=()=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 pt-20",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-4xl w-full mx-4 max-h-[calc(80vh-5rem)] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Time Availability Report"}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-500 hover:text-gray-800 text-2xl font-bold",children:"×"})]}),e.jsx(k,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Task Breakdown"}),e.jsx(E,{})]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-4 text-white text-sm",children:[e.jsx(l,{}),e.jsx(N,{}),e.jsx(M,{}),e.jsx(T,{}),e.jsx(O,{})]}),d&&e.jsx(v,{}),e.jsx(He,{isOpen:c,onClose:()=>g(!1)})]})}async function Je(t){const{data:s,error:n}=await $.from("org_nodes").select("*").eq("root_category",t).not("is_completed","is",!0),r=s;if(n)throw n;return re(r??[])[t]??{id:0,name:t,type:"category",root_category:t,children:[]}}const Ve=new pe,ee=["Household","Finances","Cleo","Job","Social","Personal","Orphans"];function Ge(){const{tabName:t}=he(),s=t||"Household",[n,r]=x.useState(()=>{const o=localStorage.getItem("darkMode");return o!==null?JSON.parse(o):window.matchMedia("(prefers-color-scheme: dark)").matches}),[a,u]=x.useState(!1);x.useEffect(()=>{n?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[n]);const{data:d,isLoading:i,error:c}=be({queryKey:["orgTree",s],queryFn:()=>Je(s),placeholderData:ye});if(t&&!ee.includes(t))return e.jsx(ge,{to:"/org-chart/Household",replace:!0});const g=()=>{const o=!n;r(o),localStorage.setItem("darkMode",JSON.stringify(o)),o?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};return e.jsxs("div",{className:"min-h-screen w-screen flex flex-col bg-white dark:bg-gray-900 transition-colors",children:[e.jsxs("nav",{className:"flex justify-between items-center bg-gray-900 dark:bg-gray-800 sticky top-0 z-10 px-4",children:[e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(V,{to:"/",className:"px-4 py-3 text-lg font-medium text-gray-300 hover:text-white hover:bg-gray-800 dark:hover:bg-gray-700 transition-colors mr-4",children:"← Home"}),ee.map(o=>e.jsx(V,{to:`/org-chart/${o}`,className:`px-6 py-3 text-lg font-medium border-b-2 transition-colors duration-200 ${s===o?"border-white text-white bg-gray-800 dark:bg-gray-700":"border-transparent text-gray-300 hover:text-white hover:bg-gray-800 dark:hover:bg-gray-700"}`,children:o},o))]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:g,className:"text-gray-300 hover:text-white transition-colors",title:n?"Switch to light mode":"Switch to dark mode",children:n?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),e.jsxs("button",{onClick:()=>u(!0),className:"text-gray-300 hover:text-white transition-colors flex items-center space-x-1",title:"Quick Add/Edit Task",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"hidden sm:inline text-sm",children:"Quick Add"})]}),e.jsx(Ke,{})]})]}),e.jsxs("main",{className:"flex-1 flex items-center justify-center p-4",children:[i&&e.jsxs("div",{className:"text-gray-900 dark:text-gray-100",children:["Loading ",s," tree..."]}),c&&e.jsxs("div",{className:"text-red-600 dark:text-red-400",children:["Error loading ",s," tree"]}),d&&e.jsx(Ue,{tree:d,tabName:s})]}),e.jsx(Ie,{isOpen:a,onClose:()=>u(!1)})]})}const rt=xe(function(){return e.jsx(fe,{client:Ve,children:e.jsx(Ge,{})})});export{rt as default};
